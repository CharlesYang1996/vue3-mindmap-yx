import{m as t,o as e,P as n,t as a,h as o,l,a as i,s,d as r,r as d,u as c,w as u,v as h,c as p,b as m,F as g,e as v,f,g as y,z as x,i as b,j as w,k as $,n as M,p as _,q as B,x as k,y as z,A as L,B as E,C,D as j,E as N,G as D}from"./vendor.5920f0b5.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(n){const a=new URL(t,location),o=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((n,l)=>{const i=new URL(t,a);if(self[e].moduleMap[i])return n(self[e].moduleMap[i]);const s=new Blob([`import * as m from '${i}';`,`${e}.moduleMap['${i}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){l(new Error(`Failed to import: ${t}`)),o(r)},onload(){n(self[e].moduleMap[i]),o(r)}});document.head.appendChild(r)})),self[e].moduleMap={}}}("/vue3-mindmap/assets/");var S=[{name:"如何学习D3",children:[{name:"预备知识",children:[{name:"HTML & CSS"},{name:"JavaScript"},{name:"DOM"},{name:"SVG"},{name:"test\ntest"}]},{name:"安装",_children:[{name:"折叠节点"}]},{name:"入门",children:[{name:"选择集"},{name:"test"},{name:"绑定数据"},{name:"添加删除元素"},{name:"简单图形",children:[{name:"柱形图"},{name:"折线图"},{name:"散点图"}]},{name:"比例尺"},{name:"生成器"},{name:"过渡"}],left:!0},{name:"进阶",left:!0},{name:"一级节点",children:[{name:"子节点1"},{name:"子节点2"},{name:"子节点3"}]}]}];const V=t();var A={container:"Mindmap_container_zpjgs","svg-wrapper":"Mindmap_svg-wrapper_zpjgs",svg:"Mindmap_svg_zpjgs",trigger:"Mindmap_trigger_zpjgs","add-btn":"Mindmap_add-btn_zpjgs",text:"Mindmap_text_zpjgs",selected:"Mindmap_selected_zpjgs",content:"Mindmap_content_zpjgs",root:"Mindmap_root_zpjgs",edited:"Mindmap_edited_zpjgs",outline:"Mindmap_outline_zpjgs","button-list":"Mindmap_button-list_zpjgs","right-bottom":"Mindmap_right-bottom_zpjgs","top-right":"Mindmap_top-right_zpjgs",disabled:"Mindmap_disabled_zpjgs",gps:"Mindmap_gps_zpjgs",fit:"Mindmap_fit_zpjgs",download:"Mindmap_download_zpjgs",undo:"Mindmap_undo_zpjgs",redo:"Mindmap_redo_zpjgs",close:"Mindmap_close_zpjgs"};class R{constructor(t,e,n,a){this.w=t,this.h=e,this.y=n,this.c=a,this.cs=a.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function U(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function G(t){return t.y+t.h}class O{constructor(t,e,n){this.lowY=t,this.index=e,this.next=n}}function P(t,e,n){for(;null!==n&&t>=n.lowY;)n=n.next;return new O(t,e,n)}function H(t,e,n,a){t.c[e].mod+=a,t.c[e].msel+=a,t.c[e].mser+=a,function(t,e,n,a){if(n!==e-1){const o=e-n;t.c[n+1].shift+=a/o,t.c[e].shift-=a/o,t.c[e].change-=a-a/o}}(t,e,n,a)}function I(t){return 0===t.cs?t.tl:t.c[0]}function q(t){return 0===t.cs?t.tr:t.c[t.cs-1]}function Y(t,e,n){let a=t.c[e-1],o=a.mod,l=t.c[e],i=l.mod;for(;null!==a&&null!==l;){G(a)>n.lowY&&(n=n.next);const s=o+a.prelim+a.w-(i+l.prelim);s>0&&(i+=s,H(t,e,n.index,s));const r=G(a),d=G(l);r<=d&&(a=q(a),null!==a&&(o+=a.mod)),r>=d&&(l=I(l),null!==l&&(i+=l.mod))}null===a&&null!==l?function(t,e,n,a){const o=t.c[0].el;o.tl=n;const l=a-n.mod-t.c[0].msel;o.mod+=l,o.prelim-=l,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,l,i):null!==a&&null===l&&function(t,e,n,a){const o=t.c[e].er;o.tr=n;const l=a-n.mod-t.c[e].mser;o.mod+=l,o.prelim-=l,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,a,o)}function K(t){if(0===t.cs)return void U(t);K(t.c[0]);let e=P(G(t.c[0].el),0,null);for(let n=1;n<t.cs;n++){K(t.c[n]);const a=G(t.c[n].er);Y(t,n,e),e=P(a,n,e)}!function(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}(t),U(t)}function F(t,e){e+=t.mod,t.x=t.prelim+e,function(t){let e=0,n=0;for(let a=0;a<t.cs;a++)e+=t.c[a].shift,n+=e+t.c[a].change,t.c[a].mod+=n}(t);for(let n=0;n<t.cs;n++)F(t.c[n],e)}function J(t){K(t),F(t,0)}class T{constructor(t,e){this.gap=t,this.bottomPadding=e}addBoundingBox(t,e){return{width:t+this.gap,height:e+this.bottomPadding}}removeBoundingBox(t,e){return{x:t+this.gap/2,y:e}}}class W{constructor(t){this.bb=t}layout(t){const e=this.convert(t);J(e);const{boundingBox:n,result:a}=this.assignLayout(e,t);return{result:a,boundingBox:n}}convert(t,e=0){const{width:n,height:a}=this.bb.addBoundingBox(t.width,t.height),o=[];if(t.children&&t.children.length)for(let l=0;l<t.children.length;l++)o[l]=this.convert(t.children[l],e+a);return new R(n,a,e,o)}assignCoordinates(t,e){const{x:n,y:a}=this.bb.removeBoundingBox(t.x,t.y);e.x=n,e.y=a;for(let o=0;o<t.c.length;o++)this.assignCoordinates(t.c[o],e.children[o])}getSize(t,e){const{x:n,y:a,width:o,height:l}=t;if(e||(e={left:n,right:n+o,top:a,bottom:a+l}),e.left=Math.min(e.left,n),e.right=Math.max(e.right,n+o),e.top=Math.min(e.top,a),e.bottom=Math.max(e.bottom,a+l),t.children)for(const i of t.children)this.getSize(i,e);return e}assignLayout(t,e,n){const{x:a,y:o}=this.bb.removeBoundingBox(t.x,t.y);e.x=a,e.y=o;const{width:l,height:i}=e;n||(n={left:a,right:a+l,top:o,bottom:o+i}),n.left=Math.min(n.left,a),n.right=Math.max(n.right,a+l),n.top=Math.min(n.top,o),n.bottom=Math.max(n.bottom,o+i);for(let s=0;s<t.c.length;s++)this.assignLayout(t.c[s],e.children[s],n);return{result:e,boundingBox:n}}}const X=e(n);let Z=0,Q=0;function tt(t,e){const n=e(t.name),a={rawData:t,width:n.height,height:n.width,x:0,y:0},{children:o}=t;if(o){const t=a.children=[];o.forEach((n=>{t.push(tt(n,e))}))}return a}const et=(t,e="0",n=null,a)=>{const o=t.y,l=t.x;let i="",s=!1,r=o,d=l;n&&(s=n.left,r=n.x,d=n.y,i=a||X(`${Z+=1}`));const c={x:o,y:l,width:t.height,height:t.width,id:e,gKey:Q+=1,depth:Math.floor(e.length/2),name:t.rawData.name,px:0,py:0,rawData:t.rawData,parent:n,color:i,left:s,dx:o-r,dy:l-d};return t.children&&(c.children=[],t.children.forEach(((t,n)=>{var a;null==(a=c.children)||a.push(et(t,`${e}-${n}`,c,i))}))),c};function nt(t){[t.width,t.height]=[t.height,t.width]}const at=t=>{[t.x,t.y]=[t.y,t.x]},ot=t=>{t.parent?(t.dx=t.x-t.parent.x,t.dy=t.y-t.parent.y):(t.dx=0,t.dy=0)},lt=(t,e)=>{t.id=e},it=t=>{t.parent&&(t.parent.color?t.color=t.parent.color:t.color||(t.color=X(`${Z+=1}`)))},st=(t,e,n="0")=>{var a;e.forEach((e=>{e(t,n)})),null==(a=t.children)||a.forEach(((t,a)=>{st(t,e,`${n}-${a}`)}))},rt=(t,e)=>{const n=new T(e,t);return new W(n)};class dt{constructor(t,e,n,a){const o=tt(t,a);this.layout=rt(e,n),this.layout.layout(o),this.data=et(o),this.getSize=a}setBoundingBox(t,e){this.layout=rt(t,e),this.renew()}find(t){const e=t.split("-").map((t=>~~t));let n=this.data;for(let a=1;a<e.length;a++){if(!n||!n.children)return null;n=n.children[e[a]]}return n}rename(t,e){if(t.length>0){const n=this.find(t);if(n&&n.name!==e){n.name=e,n.rawData.name=e;const t=this.getSize(n.name);n.width=t.width,n.height=t.height,this.renew()}return n}return null}reparent(t,e){var n,a;if(t===e)return null;const o=this.find(t),l=this.find(e),i=e.split("-").pop();if(i&&o&&l){const t=l.parent;null==(n=null==t?void 0:t.children)||n.splice(~~i,1),null==(a=null==t?void 0:t.rawData.children)||a.splice(~~i,1),l.parent=o,l.gKey=Q+=1,l.depth=l.parent.depth+1,1===l.depth&&(l.color=X(`${Z+=1}`)),o.children?o.children.push(l):o.children=[l],o.rawData.children?o.rawData.children.push(l.rawData):o.rawData.children=[l.rawData],st(this.data,[nt]),this.layout.layout(this.data),st(this.data,[nt,at,ot,lt,it])}return l}move(t,e,n=0){const a=t.split("-"),o=e.split("-");let l=a.pop(),i=o.pop();if(t===e||a.length!==o.length||!l||!i)return null;const s=this.find(t);if(s&&s.parent){l=parseInt(l,10),i=parseInt(i,10),l<i&&(i-=1);const{children:t}=s.parent,{children:e}=s.parent.rawData;if(t&&e)return t.splice(l,1),t.splice(i+n,0,s),e.splice(l,1),e.splice(i+n,0,s.rawData),st(this.data,[nt]),this.layout.layout(this.data),st(this.data,[nt,at,ot,lt]),s}return null}add(t,e){const n=this.find(t);if(n){n.children||(n.children=[]),n.rawData.children||(n.rawData.children=[]);const t=this.getSize(e),a={name:e},o=n.color?n.color:X(`${Z+=1}`),l={id:`${n.id}-${n.children.length}`,name:e,rawData:a,parent:n,left:n.left,color:o,gKey:Q+=1,width:t.width,height:t.height,depth:n.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0};return n.children.push(l),n.rawData.children.push(a),this.renew(),l}return null}renew(){st(this.data,[nt]),this.layout.layout(this.data),st(this.data,[nt,at,ot])}}const ct=t=>{const e=t.split("\n");return e.length>2&&""===e[e.length-1]&&e.pop(),e},ut=(t,e)=>a().duration(t).ease(e);function ht(){var t,e;return null==(e=null==(t=this.parentNode)?void 0:t.parentNode)?void 0:e.parentNode}const pt=l().source((t=>t.source)).target((t=>t.target)),mt=i().curve(s);let gt=pt;const vt=({source:t,target:e})=>mt([t,e]),ft=12,yt=2,xt=ft+2*yt;let bt=4,wt=18,$t=Math.min(wt/2-1,10),Mt=!1;V.on("branch",(t=>bt=t||bt)),V.on("sharp-corner",(t=>{Mt=t||!1,gt=t?vt:pt})),V.on("gap",(t=>{if(!t)return;const e=t[0];wt=t[1],$t=Math.min(wt/2-1,10),$t=Math.min(e/2-1,$t)}));const _t=t=>{const e=["node"];return t&&(e.push(`depth-${t.depth}`),0===t.depth&&e.push(A.root)),e},Bt=t=>`translate(${t.dx+t.px},${t.dy+t.py})`,kt=t=>t.id,zt=t=>{const e=ct(t.name),n=t.height/e.length;return e.map((t=>({name:t,height:n})))},Lt=t=>{let e=0,n=0;const a=Math.max($t-3,0),o=bt/2;let l=o;t.parent&&(e=t.parent.width,n=t.parent.height,0===t.parent.depth&&(Mt||(e/=2),n/=2,l=0));const i=[-t.dx+e-t.px,-t.dy+n+l-t.py],s=[0,t.height+o];return`${gt({source:i,target:s})}L${t.width+a},${s[1]}`},Et=(t,e)=>{const n=t.attr("class",(t=>_t(t).join(" "))).attr("data-id",kt);(e?n.transition(e):n).attr("transform",Bt)},Ct=t=>{t.attr("alignment-baseline","text-before-edge").text((t=>t.name||" ")).attr("x",0).attr("dy",((t,e)=>e?t.height:0))},jt=(t,e,n=4)=>{t.attr("x",-e).attr("y",-e).attr("rx",n).attr("ry",n).attr("width",(t=>t.width+2*e)).attr("height",(t=>t.height+2*e))},Nt=(t,e)=>{t.attr("class",A["add-btn"]).attr("transform",(t=>((t,e)=>{const n=0===t.depth?t.height/2:t.height+bt/2;return`translate(${t.width+e+xt/2+8},${n})`})(t,e)))},Dt=(t,e)=>{t.attr("class",A.trigger).attr("x",-e).attr("y",-e).attr("width",(t=>t.width+2*e+8+xt)).attr("height",(t=>t.height+2*e))},St=(t,e)=>{const n=t.attr("stroke",(t=>t.color)).attr("stroke-width",bt);(e?n.transition(e):n).attr("d",(t=>Lt(t)))},Vt=t=>{const e=t.append("tspan");return Ct(e),e},At=t=>(Ct(t),t),Rt=t=>{const e=t.append("g");return(t=>{const e=-yt-ft/2,n=ft+2*yt;t.attr("x",e).attr("y",e).attr("rx",4).attr("ry",4).attr("width",n).attr("height",n)})(e.append("rect")),e.append("path").attr("d",((t,e)=>{const n=-e/2,a=-t/2,o=t/2,l=e/2;return`M${l},${o}H${o}V${l}H${a}V${o}H${n}V${a}H${a}V${n}H${o}V${a}H${l}V${o}Z`})(2,ft)),e};function Ut(){const t=this.querySelector(`g.${A["add-btn"]}`);t&&(t.style.opacity="1")}function Gt(){const t=this.querySelector(`g.${A["add-btn"]}`);t&&(t.style.opacity="0")}var Ot=r({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(t,e){const n=d(!1),a=c();V.on("showContextmenu",(t=>n.value=t));const o=()=>n.value=!1;return{style:a,show:n,close:o,onClick:t=>{o(),e.emit("click-item",t)}}}});var Pt={container:"Contextmenu_container_154ic",menu:"Contextmenu_menu_154ic",disabled:"Contextmenu_disabled_154ic"};(Ot.__cssModules={}).$style=Pt,Ot.render=function(t,e,n,a,o,l){return u((f(),p("div",{class:t.style.container},[m("div",{onMousedown:e[1]||(e[1]=(...e)=>t.close&&t.close(...e))},null,32),m("div",{id:t.style.menu,style:{top:t.position.top+"px",left:t.position.left+"px"}},[(f(!0),p(g,null,v(t.groups,((e,n)=>(f(),p("ul",{key:n},[(f(!0),p(g,null,v(e,(e=>(f(),p("li",{class:e.disabled?t.style.disabled:"",key:e.name,onClick:n=>t.onClick(e.name)},y(e.title),11,["onClick"])))),128))])))),128))],12,["id"])],2)),[[h,t.show]])};var Ht=r({name:"Mindmap",components:{Contextmenu:Ot},props:{modelValue:{type:Array,required:!0},width:Number,height:Number,xGap:{type:Number,default:50},yGap:{type:Number,default:18},branch:{type:Number,default:4},scaleExtent:{default:()=>[.1,8]},centerBtn:Boolean,fitBtn:Boolean,downloadBtn:Boolean,undoBtn:Boolean,addNodeBtn:Boolean,edit:Boolean,drag:Boolean,keyboard:Boolean,contextmenu:Boolean,zoom:Boolean,sharpCorner:Boolean},setup(t){let e=d(k);const n=d({left:0,top:0}),a=d(),l=d(),i=d(),s=d(),r=d(),c=d(),u=d(),h=d(),p=d(),m=d(),g=x().on("zoom",(function(t){if(!h.value)return;e.value=t.transform,h.value.attr("transform",t.transform.toString())})).scaleExtent(t.scaleExtent),v=b().container(ht).on("drag",(function(t,e){var n;const a=null==(n=this.parentNode)?void 0:n.parentNode;if(E.value=!1,!h.value)return;O(a,e,[t.x-e.x,t.y-e.y]);const o=B(t,i.value);o[1]+=y.data.y;const l=h.value.selectAll("g.node").filter((t=>{if(t!==e&&t!==e.parent&&!t.id.startsWith(e.id)){const e={x0:t.x-$t,x1:t.x+t.width+$t,y0:t.y-$t,y1:t.y+t.height+$t};return o[0]>e.x0&&o[1]>e.y0&&o[0]<e.x1&&o[1]<e.y1}return!1})),s=Array.from(document.getElementsByClassName(A.outline)),r=l.node();s.forEach((t=>{t!==r&&t.classList.remove(A.outline)})),null==r||r.classList.add(A.outline)})).on("end",(function(t,e){var n;const a=null==(n=this.parentNode)?void 0:n.parentNode;E.value=!0;const o=document.getElementsByClassName(A.outline)[0];if(o){o.classList.remove(A.outline);const t=o.getAttribute("data-id");if(!t)throw new Error("outline data-id null");return e.px=0,e.py=0,void Q(t,e.id)}const l=a.parentNode;let i=e,s=e;if(M(l).selectAll(`g.${_t(e).join(".")}`).filter((t=>t!==e)).each((t=>{t.y>e.y&&t.y<e.y+e.py&&t.y>s.y&&(s=t),t.y<e.y&&t.y>e.y+e.py&&t.y<i.y&&(i=t)})),i!==e)return e.px=0,e.py=0,void tt(e.id,i.id);if(s!==e)return e.px=0,e.py=0,void tt(e.id,s.id,1);O(a,e,[0,0],500)})),f=new ResizeObserver((t=>{if(!m.value)return;const e=t[0],n=e.target,a=2*(parseInt(getComputedStyle(n).paddingLeft||"0",10)+parseInt(getComputedStyle(n.parentNode).borderTopWidth||"0",10));m.value.attr("width",e.contentRect.width+a).attr("height",e.contentRect.height+a)}));let y,L=!1;const E=d(!0),C=w((()=>[[{title:"放大",name:"zoomin",disabled:e.value.k>=t.scaleExtent[1]},{title:"缩小",name:"zoomout",disabled:e.value.k<=t.scaleExtent[0]},{title:"缩放至合适大小",name:"zoomfit",disabled:!1}],[{title:"全选",name:"selectall",disabled:!0}]])),j=d(!0);$((()=>{l.value&&i.value&&s.value&&r.value&&c.value&&(u.value=M(l.value),h.value=M(i.value),p.value=M(s.value).attr("width",0).attr("height",0),m.value=M(r.value),f.observe(c.value),y=new dt(JSON.parse(JSON.stringify(t.modelValue[0])),t.xGap,t.yGap,U),R(),m.value.raise(),c.value.addEventListener("blur",I),c.value.addEventListener("mousedown",(t=>t.stopPropagation())),nt(),at(),u.value.on("mousedown",(()=>{const t=document.getElementsByClassName(A.selected)[0];null==t||t.classList.remove(A.selected)})),F(t.zoom),X(t.contextmenu))})),_((()=>t.branch),(t=>V.emit("branch",t))),_((()=>t.sharpCorner),(t=>{V.emit("sharp-corner",t),R()})),_((()=>[t.branch,t.addNodeBtn]),(()=>R())),_((()=>[t.xGap,t.yGap]),(t=>{V.emit("gap",t),y.setBoundingBox(t[0],t[1]),R()})),_((()=>[t.drag,t.edit]),(t=>{W(t[0]||t[1]),T(t[0]),J(t[1])})),_((()=>t.zoom),(t=>F(t))),_(E,(t=>{var e;null==(e=h.value)||e.selectAll(`g.${A["add-btn"]}`).style("display",t?"":"none")})),_((()=>t.contextmenu),(t=>X(t)));const N=t=>{const e=Rt(t);return e.on("click",Y),e},D=e=>{var n;const a=!(null==(n=e.data()[0])?void 0:n.depth),o=e.append("g");Et(o),St(o.append("path"));const l=o.append("g").attr("class",A.content),i=l.append("rect"),s=l.append("g").attr("class",A.text),r=s.append("rect"),d=s.append("text").selectAll("tspan").data(zt).enter().append("tspan");let c;return Ct(d),t.addNodeBtn&&(c=N(l)),a?(Dt(i,10),jt(r,10,6),c&&Nt(c,10)):(Dt(i,$t),jt(r,$t),c&&Nt(c,$t)),P(o,a),o.each(((t,e)=>{t.children&&R(t.children,o.filter(((t,n)=>e===n)))})),l.raise(),o},S=e=>{var n;const a=!(null==(n=e.data()[0])?void 0:n.depth),o=ut(500,z);Et(e,o),St(e.select(":scope > path"),o);const l=e.select(`:scope > g.${A.content}`),i=l.select(":scope > rect"),s=l.select(`g.${A.text}`),r=s.select("rect");s.select("text").selectAll("tspan").data(zt).join(Vt,At,(t=>t.remove()));let d=l.select(`g.${A["add-btn"]}`);return t.addNodeBtn?d.node()||(d=N(l)):d.remove(),a?(Dt(i,10),jt(r,10,6),Nt(d,10)):(Dt(i,$t),jt(r,$t),Nt(d,$t)),e.each(((t,n)=>{t.children&&R(t.children,e.filter(((t,e)=>n===e)))})),l.raise(),e},R=(t=[y.data],e=h.value)=>{e.selectAll(`g.${_t(t[0]).join(".")}`).data(t,(t=>t.gKey)).join(D,S)},U=t=>{if(!p.value)throw new Error("asstSvg undefined");const e=ct(t),n=p.value.append("text");n.selectAll("tspan").data(e).enter().append("tspan").text((t=>t)).attr("x",0);const a=n.node().getBBox();return n.remove(),{width:Math.max(a.width,22),height:Math.max(a.height,22)*e.length}};function G(t){const e=t instanceof SVGGElement?t:document.querySelector(`g[data-id='${kt(t)}']`),n=document.getElementsByClassName(A.selected)[0];if(!e)throw new Error(`g[data-id='${kt(t)}'] is null`);n?n!==e?(n.classList.remove(A.selected),e.classList.add(A.selected)):L=!0:e.classList.add(A.selected)}const O=(t,e,n,a=0)=>{const o=ut(a,z);e.px=n[0],e.py=n[1],M(t).transition(o).attr("transform",Bt),M(`g[data-id='${kt(e)}'] > path`).transition(o).attr("d",(t=>Lt(t)))},P=(e,n)=>{if(t.drag||t.edit){const a=e.select(`:scope > g.${A.content} > g.${A.text}`);a.on("mousedown",q),t.drag&&!n&&v(a),t.edit&&a.on("click",H)}t.addNodeBtn&&e.select(`:scope > g.${A.content}`).on("mouseenter",Ut).on("mouseleave",Gt)};function H(t,e){var n,a;const o=null==(n=this.parentNode)?void 0:n.parentNode;if(L&&m.value&&c.value){o.classList.add(A.edited),L=!1,m.value.attr("x",e.x-2).attr("y",e.y-y.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const t=c.value;t.textContent=e.name,t.focus(),null==(a=getSelection())||a.selectAllChildren(t)}}const I=()=>{var t;if(null==(t=document.getElementsByClassName(A.edited)[0])||t.classList.remove(A.edited,A.selected),r.value&&c.value){r.value.style.display="none";const t=r.value.getAttribute("data-id"),e=r.value.getAttribute("data-name"),n=c.value.textContent;t&&n&&n!==e&&Z(t,n)}},q=(t,e)=>{t.stopPropagation(),G(e)},Y=(t,e)=>{const n=et(e.id,"");if(!h.value||!n)return;const a=h.value.selectAll(`g[data-id='${kt(n)}'] g.${A.text}`).node();a&&(L=!0,H.call(a,t,n))},K=t=>{if(t.preventDefault(),!a.value)return;V.emit("showContextmenu",!0);const e=((t,e)=>{const{pageX:n,pageY:a}=e,o=t.getBoundingClientRect();return{left:n-(o.left+window.pageXOffset),top:a-(o.top+window.pageYOffset)}})(a.value,t);n.value=e;const o=t.composedPath().find((t=>{var e;return null==(e=t.classList)?void 0:e.contains("node")}));o&&G(o),j.value=!o},F=t=>{u.value&&(t?(g(u.value),u.value.on("dblclick.zoom",null)):u.value.on(".zoom",null))},J=t=>{if(!c.value||!h.value)return;const e=h.value.selectAll(`g.${A.text}`);t?e.on("click",H):e.on("click",null)},T=t=>{if(!h.value)return;const e=h.value.selectAll(`g.node:not(.${A.root}) > g > g.${A.text}`);t?v(e):e.on(".drag",null)},W=t=>{if(!h.value)return;const e=h.value.selectAll(`g.${A.text}`);t?e.on("mousedown",q):e.on("mousedown",null)},X=t=>{a.value&&(t?a.value.addEventListener("contextmenu",K):a.value.removeEventListener("contextmenu",K))},Z=(t,e)=>{y.rename(t,e),R()},Q=(t,e)=>{y.reparent(t,e),R()},tt=(t,e,n=0)=>{y.move(t,e,n),R()},et=(t,e)=>{const n=y.add(t,e);return R(),n},nt=()=>{if(!u.value)return;const t=y.data;g.translateTo(u.value,0+t.width/2,0+t.height/2)},at=()=>{if(!u.value||!i.value||!l.value)return;const t=i.value.getBBox(),e=l.value.getBoundingClientRect(),n=Math.min(e.width/t.width,e.height/t.height),a=e.width/2,o=e.height/2,s=t.width*n/2,r=t.height*n/2,d=k.translate(-t.x*n+a-s,-t.y*n+o-r).scale(n);g.transform(u.value,d)},ot=t=>{u.value&&g.scaleBy(u.value,t?1.1:.9)};return{wrapperEle:a,svgEle:l,gEle:i,style:A,asstSvgEle:s,foreignEle:r,foreignDivEle:c,centerView:nt,fitView:at,download:()=>{var t,e;a.value&&(t=a.value,e=y.data.name,o(t).then((t=>{const n=t.toDataURL(),a=open();a&&(a.document.write(`<img src='${n}'>`),a.document.title=e,a.document.close())})))},showViewMenu:j,viewMenu:C,nodeMenu:[[{title:"新建子节点",name:"add",disabled:!1}],[{title:"删除节点",name:"delete",disabled:!1}],[{title:"全选",name:"selectall",disabled:!0}],[{title:"折叠节点",name:"collapse",disabled:!0},{title:"展开节点",name:"expand",disabled:!0}]],contextmenuPos:n,onClickMenu:t=>{if("zoomfit"===t)at();else if("zoomin"===t)ot(!0);else if("zoomout"===t)ot(!1);else if("add"===t){const t=M(`.${A.selected}`).data()[0];Y(new MouseEvent("click"),t)}}}}});const It={ref:"gEle"},qt={ref:"foreignEle",style:{display:"none"}},Yt={ref:"foreignDivEle",contenteditable:""},Kt={ref:"asstSvgEle"};Ht.render=function(t,e,n,a,o,l){const i=L("contextmenu");return f(),p("div",{class:t.style.container},[m("div",{id:t.style["svg-wrapper"],ref:"wrapperEle"},[(f(),p("svg",{class:t.style.svg,ref:"svgEle"},[m("g",It,[(f(),p("foreignObject",qt,[m("div",Yt,null,512)],512))],512)],2))],8,["id"]),(f(),p("svg",Kt,null,512)),m("div",{class:[t.style["button-list"],t.style["right-bottom"]]},[t.centerBtn?(f(),p("button",{key:0,onClick:e[1]||(e[1]=e=>t.centerView())},[m("i",{class:t.style.gps},null,2)])):E("",!0),t.fitBtn?(f(),p("button",{key:1,onClick:e[2]||(e[2]=e=>t.fitView())},[m("i",{class:t.style.fit},null,2)])):E("",!0),t.downloadBtn?(f(),p("button",{key:2,onClick:e[3]||(e[3]=e=>t.download())},[m("i",{class:t.style.download},null,2)])):E("",!0)],2),m(i,{position:t.contextmenuPos,groups:t.showViewMenu?t.viewMenu:t.nodeMenu,onClickItem:t.onClickMenu},null,8,["position","groups","onClickItem"])],2)};var Ft=r({name:"App",components:{Mindmap:Ht},setup(){const t=C({"center-btn":{value:!0},"fit-btn":{value:!0},"undo-btn":{value:!1,disabled:!0},"download-btn":{value:!0},"add-node-btn":{value:!0},keyboard:{value:!1,disabled:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},"sharp-corner":{value:!1},vertical:{value:!1,disabled:!0}}),e=C({branch:{value:4,min:0,max:10},"x-gap":{value:50,min:0,max:100},"y-gap":{value:18,min:0,max:100}});return{learn:S,checkboxList:t,rangeList:e}}});const Jt={class:"container"},Tt=m("div",{class:"left-top"},[m("a",{href:"https://github.com/hellowuxin/vue3-mindmap",target:"_blank"},"GitHub")],-1),Wt=m("div",{class:"right-top"},[m("span",null,"Props")],-1),Xt={class:"right-bottom"};Ft.render=function(t,e,n,a,o,l){const i=L("mindmap");return f(),p("div",Jt,[Tt,Wt,m(i,{class:"left-bottom",modelValue:t.learn,"onUpdate:modelValue":e[1]||(e[1]=e=>t.learn=e),branch:t.rangeList.branch.value,"x-gap":t.rangeList["x-gap"].value,"y-gap":t.rangeList["y-gap"].value,zoom:t.checkboxList.zoom.value,"fit-btn":t.checkboxList["fit-btn"].value,"center-btn":t.checkboxList["center-btn"].value,"download-btn":t.checkboxList["download-btn"].value,drag:t.checkboxList.drag.value,edit:t.checkboxList.edit.value,"add-node-btn":t.checkboxList["add-node-btn"].value,"sharp-corner":t.checkboxList["sharp-corner"].value,contextmenu:t.checkboxList.contextmenu.value},null,8,["modelValue","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","contextmenu"]),m("div",Xt,[(f(!0),p(g,null,v(t.checkboxList,((t,e)=>(f(),p("div",{key:e},[u(m("input",{type:"checkbox",name:e.toString(),"onUpdate:modelValue":e=>t.value=e,disabled:t.disabled},null,8,["name","onUpdate:modelValue","disabled"]),[[j,t.value]]),m("label",{for:e.toString()},y(e),9,["for"])])))),128)),(f(!0),p(g,null,v(t.rangeList,((t,e)=>(f(),p("div",{key:e},[u(m("input",{type:"range",name:e,"onUpdate:modelValue":e=>t.value=e,min:t.min,max:t.max},null,8,["name","onUpdate:modelValue","min","max"]),[[N,t.value,void 0,{number:!0}]]),m("label",{for:e},y(e)+"（"+y(t.value)+"）",9,["for"])])))),128))])])},D(Ft).mount("#app");
