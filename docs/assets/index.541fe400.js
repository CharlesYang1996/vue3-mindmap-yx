import{m as e,o as t,P as n,t as a,h as l,l as o,a as i,s as r,f as s,r as c,d,u,w as h,v as p,c as m,b as g,F as v,e as f,g as x,i as y,z as b,j as w,k as $,n as _,p as M,q as B,x as k,y as z,A as L,B as E,C,D as N,E as S,G as D,H as V}from"./vendor.7fffd199.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const a=new URL(e,location),l=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,o)=>{const i=new URL(e,a);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const r=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){o(new Error(`Failed to import: ${e}`)),l(s)},onload(){n(self[t].moduleMap[i]),l(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/vue3-mindmap/assets/");var A=[{name:"如何学习D3",children:[{name:"预备知识",children:[{name:"HTML & CSS"},{name:"JavaScript"},{name:"DOM"},{name:"SVG"},{name:"test\ntest"}]},{name:"安装",collapse:!0,children:[{name:"折叠节点"}]},{name:"入门",children:[{name:"选择集"},{name:"test"},{name:"绑定数据"},{name:"添加删除元素"},{name:"简单图形",children:[{name:"柱形图"},{name:"折线图"},{name:"散点图"}]},{name:"比例尺"},{name:"生成器"},{name:"过渡"}],left:!0},{name:"进阶",left:!0},{name:"一级节点",children:[{name:"子节点1"},{name:"子节点2"},{name:"子节点3"}]}]}];const j=e();var R={container:"Mindmap_container_uvtzx","svg-wrapper":"Mindmap_svg-wrapper_uvtzx",svg:"Mindmap_svg_uvtzx",trigger:"Mindmap_trigger_uvtzx","add-btn":"Mindmap_add-btn_uvtzx","expand-btn":"Mindmap_expand-btn_uvtzx",text:"Mindmap_text_uvtzx",selected:"Mindmap_selected_uvtzx",content:"Mindmap_content_uvtzx",root:"Mindmap_root_uvtzx",edited:"Mindmap_edited_uvtzx",outline:"Mindmap_outline_uvtzx",collapse:"Mindmap_collapse_uvtzx","button-list":"Mindmap_button-list_uvtzx","right-bottom":"Mindmap_right-bottom_uvtzx","top-right":"Mindmap_top-right_uvtzx",disabled:"Mindmap_disabled_uvtzx",gps:"Mindmap_gps_uvtzx",fit:"Mindmap_fit_uvtzx",download:"Mindmap_download_uvtzx",undo:"Mindmap_undo_uvtzx",redo:"Mindmap_redo_uvtzx",close:"Mindmap_close_uvtzx"};class U{constructor(e,t,n,a){this.w=e,this.h=t,this.y=n,this.c=a,this.cs=a.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function G(e){0===e.cs?(e.el=e,e.er=e,e.msel=e.mser=0):(e.el=e.c[0].el,e.msel=e.c[0].msel,e.er=e.c[e.cs-1].er,e.mser=e.c[e.cs-1].mser)}function O(e){return e.y+e.h}class P{constructor(e,t,n){this.lowY=e,this.index=t,this.next=n}}function H(e,t,n){for(;null!==n&&e>=n.lowY;)n=n.next;return new P(e,t,n)}function K(e,t,n,a){e.c[t].mod+=a,e.c[t].msel+=a,e.c[t].mser+=a,function(e,t,n,a){if(n!==t-1){const l=t-n;e.c[n+1].shift+=a/l,e.c[t].shift-=a/l,e.c[t].change-=a-a/l}}(e,t,n,a)}function I(e){return 0===e.cs?e.tl:e.c[0]}function q(e){return 0===e.cs?e.tr:e.c[e.cs-1]}function Y(e,t,n){let a=e.c[t-1],l=a.mod,o=e.c[t],i=o.mod;for(;null!==a&&null!==o;){O(a)>n.lowY&&(n=n.next);const r=l+a.prelim+a.w-(i+o.prelim);r>0&&(i+=r,K(e,t,n.index,r));const s=O(a),c=O(o);s<=c&&(a=q(a),null!==a&&(l+=a.mod)),s>=c&&(o=I(o),null!==o&&(i+=o.mod))}null===a&&null!==o?function(e,t,n,a){const l=e.c[0].el;l.tl=n;const o=a-n.mod-e.c[0].msel;l.mod+=o,l.prelim-=o,e.c[0].el=e.c[t].el,e.c[0].msel=e.c[t].msel}(e,t,o,i):null!==a&&null===o&&function(e,t,n,a){const l=e.c[t].er;l.tr=n;const o=a-n.mod-e.c[t].mser;l.mod+=o,l.prelim-=o,e.c[t].er=e.c[t-1].er,e.c[t].mser=e.c[t-1].mser}(e,t,a,l)}function F(e){if(0===e.cs)return void G(e);F(e.c[0]);let t=H(O(e.c[0].el),0,null);for(let n=1;n<e.cs;n++){F(e.c[n]);const a=O(e.c[n].er);Y(e,n,t),t=H(a,n,t)}!function(e){e.prelim=(e.c[0].prelim+e.c[0].mod+e.c[e.cs-1].mod+e.c[e.cs-1].prelim+e.c[e.cs-1].w)/2-e.w/2}(e),G(e)}function J(e,t){t+=e.mod,e.x=e.prelim+t,function(e){let t=0,n=0;for(let a=0;a<e.cs;a++)t+=e.c[a].shift,n+=t+e.c[a].change,e.c[a].mod+=n}(e);for(let n=0;n<e.cs;n++)J(e.c[n],t)}function T(e){F(e),J(e,0)}class W{constructor(e,t){this.gap=e,this.bottomPadding=t}addBoundingBox(e,t){return{width:e+this.gap,height:t+this.bottomPadding}}removeBoundingBox(e,t){return{x:e+this.gap/2,y:t}}}class X{constructor(e){this.bb=e}layout(e){const t=this.convert(e);T(t);const{boundingBox:n,result:a}=this.assignLayout(t,e);return{result:a,boundingBox:n}}convert(e,t=0){const{width:n,height:a}=this.bb.addBoundingBox(e.width,e.height),l=[];if(e.children&&e.children.length)for(let o=0;o<e.children.length;o++)l[o]=this.convert(e.children[o],t+a);return new U(n,a,t,l)}assignCoordinates(e,t){const{x:n,y:a}=this.bb.removeBoundingBox(e.x,e.y);t.x=n,t.y=a;for(let l=0;l<e.c.length;l++)this.assignCoordinates(e.c[l],t.children[l])}getSize(e,t){const{x:n,y:a,width:l,height:o}=e;if(t||(t={left:n,right:n+l,top:a,bottom:a+o}),t.left=Math.min(t.left,n),t.right=Math.max(t.right,n+l),t.top=Math.min(t.top,a),t.bottom=Math.max(t.bottom,a+o),e.children)for(const i of e.children)this.getSize(i,t);return t}assignLayout(e,t,n){const{x:a,y:l}=this.bb.removeBoundingBox(e.x,e.y);t.x=a,t.y=l;const{width:o,height:i}=t;n||(n={left:a,right:a+o,top:l,bottom:l+i}),n.left=Math.min(n.left,a),n.right=Math.max(n.right,a+o),n.top=Math.min(n.top,l),n.bottom=Math.max(n.bottom,l+i);for(let r=0;r<e.c.length;r++)this.assignLayout(e.c[r],t.children[r],n);return{result:t,boundingBox:n}}}function Z(e,t){const n=t(e.name),a={rawData:e,width:n.height,height:n.width,x:0,y:0,children:[],_children:[]},{children:l,collapse:o}=e;if(l){const e=[];o?a._children=e:a.children=e,l.forEach((n=>{e.push(Z(n,t))}))}return a}const Q=e=>{[e.width,e.height]=[e.height,e.width]},ee=e=>{[e.x,e.y]=[e.y,e.x]},te=e=>{e.parent?(e.dx=e.x-e.parent.x,e.dy=e.y-e.parent.y):(e.dx=0,e.dy=0)},ne=(e,t)=>{e.id=t},ae=(e,t,n="0")=>{t.forEach((t=>{t(e,n)}));const{children:a}=e;if(a)for(let l=0;l<a.length;){const e=a[l];"del"===e.id?a.splice(l,1):(ae(e,t,`${n}-${l}`),l+=1)}},le=(e,t)=>{const n=new W(t,e);return new X(n)};class oe{constructor(e,a,l,o,i=t(n)){this.colorNumber=0,this.gKey=0,this.colorScale=i;const r=Z(e,o);this.layout=le(a,l),this.layout.layout(r),this.data=this.init(r),this.getSize=o}init(e,t="0",n=null,a){const l=e.y,o=e.x;let i="",r=!1,s=l,c=o;n&&(r=n.left,s=n.x,c=n.y,i=a||this.colorScale(`${this.colorNumber+=1}`));const d={x:l,y:o,width:e.height,height:e.width,id:t,gKey:this.gKey+=1,depth:Math.floor(t.length/2),name:e.rawData.name,px:0,py:0,rawData:e.rawData,parent:n,color:i,left:r,collapse:!!e.rawData.collapse,dx:l-s,dy:o-c,children:[],_children:[]};return e.children&&!d.collapse&&e.children.forEach(((e,n)=>{d.children.push(this.init(e,`${t}-${n}`,d,i))})),e._children&&d.collapse&&e._children.forEach(((e,n)=>{d._children.push(this.init(e,`${t}-${n}`,d,i))})),d}renewColor(e){e.parent&&(e.parent.color?e.color=e.parent.color:e.color||(e.color=this.colorScale(`${this.colorNumber+=1}`)))}setBoundingBox(e,t){this.layout=le(e,t),this.renew()}find(e){const t=e.split("-").map((e=>~~e));let n=this.data;for(let a=1;a<t.length;a++){if(!n||!n.children)return null;n=n.children[t[a]]||null}return n}rename(e,t){if(e.length>0){const n=this.find(e);if(n&&n.name!==t){n.name=t,n.rawData.name=t;const e=this.getSize(n.name);n.width=e.width,n.height=e.height,this.renew()}return n}return null}moveChild(e,t){var n,a;if(e===t)return null;const l=this.find(e),o=this.find(t),i=t.split("-").pop();if(i&&l&&o){const e=o.parent;null==(n=null==e?void 0:e.children)||n.splice(~~i,1),null==(a=null==e?void 0:e.rawData.children)||a.splice(~~i,1),o.parent=l,o.gKey=this.gKey+=1,o.depth=o.parent.depth+1,1===o.depth&&(o.color=this.colorScale(`${this.colorNumber+=1}`)),l.children?l.children.push(o):l.children=[o],l.rawData.children?l.rawData.children.push(o.rawData):l.rawData.children=[o.rawData],this.renew(ne,this.renewColor)}return o}moveSibling(e,t,n=0){const a=e.split("-"),l=t.split("-");let o=a.pop(),i=l.pop();if(e===t||a.length!==l.length||!o||!i)return null;const r=this.find(e);if(r&&r.parent){o=parseInt(o,10),i=parseInt(i,10),o<i&&(i-=1);const{children:e}=r.parent,{children:t}=r.parent.rawData;if(e&&t)return e.splice(o,1),e.splice(i+n,0,r),t.splice(o,1),t.splice(i+n,0,r.rawData),this.renew(ne),r}return null}add(e,t){const n=this.find(e);if(n){n.children||(n.children=[]),n.rawData.children||(n.rawData.children=[]);const e=this.getSize(t),a={name:t},l=n.color?n.color:this.colorScale(`${this.colorNumber+=1}`),o={id:`${n.id}-${n.children.length}`,name:t,rawData:a,parent:n,left:n.left,collapse:!1,color:l,gKey:this.gKey+=1,width:e.width,height:e.height,depth:n.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return n.children.push(o),n.rawData.children.push(a),this.renew(),o}return null}expand(e){return this.eoc(e,!1)}collapse(e){return this.eoc(e,!0)}eoc(e,t){const n=this.find(e);return n&&(n.collapse=t,n.rawData.collapse=t,[n._children,n.children]=[n.children,n._children],this.renew()),n}renew(...e){ae(this.data,[Q]),this.layout.layout(this.data);const t=[Q,ee,te];ae(this.data,t.concat(e))}delete(e){const t=e.split("-");if(!(t.length>=2))throw new Error("暂不支持删除根节点");{const e=t.pop(),n=this.find(t.join("-"));e&&n&&n.children&&(n.children[~~e].id="del"),this.renew(ne)}}}const ie=e=>{const t=e.split("\n");return t.length>2&&""===t[t.length-1]&&t.pop(),t},re=(e,t)=>a().duration(e).ease(t);function se(){var e,t;return null==(t=null==(e=this.parentNode)?void 0:e.parentNode)?void 0:t.parentNode}const ce=o().source((e=>e.source)).target((e=>e.target)),de=i().curve(r);let ue=ce;const he=({source:e,target:t})=>de([e,t]),pe={side:12,padding:2},me=pe.side+2*pe.padding,ge=16,ve=4,fe=2;let xe=4,ye=18,be=Math.min(ye/2-1,10),we=!1;j.on("branch",(e=>xe=e||xe)),j.on("sharp-corner",(e=>{we=e||!1,ue=e?he:ce})),j.on("gap",(e=>{if(!e)return;const t=e[0];ye=e[1],be=Math.min(ye/2-1,10),be=Math.min(t/2-1,be)}));const $e=s(((e,t)=>{e.disabled=t}));let _e=$e({title:"折叠节点",name:"collapse",disabled:!0},!0),Me=$e({title:"展开节点",name:"expand",disabled:!0},!0),Be=$e({title:"删除节点",name:"delete",disabled:!1},!0);const ke=s((()=>[[{title:"新建子节点",name:"add",disabled:!1}],[Be],[{title:"全选",name:"selectall",disabled:!0}],[_e,Me]])),ze=c(ke());[_e,Me,Be].forEach((e=>{j.on(`${e.name}-item`,(t=>{if(void 0!==t){switch(e.name){case"delete":Be=$e(e,t);break;case"expand":Me=$e(e,t);break;case"collapse":_e=$e(e,t)}ze.value=ke()}}))}));const Le=e=>{const t=["node"];return e&&t.push(`depth-${e.depth}`),t},Ee=e=>`translate(${e.dx+e.px},${e.dy+e.py})`,Ce=e=>e.id,Ne=e=>{const t=ie(e.name),n=e.height/t.length;return t.map((e=>({name:e,height:n})))},Se=e=>{let t=0,n=0;const a=Math.max(be-3,0);let l=3;e.parent&&(t=e.parent.width,n=e.parent.height,0===e.parent.depth&&(we||(t/=2),n/=2,l=0));const o=[-e.dx+t-e.px,-e.dy+n+l-e.py],i=[0,e.height+3];return`${ue({source:o,target:i})}L${e.width+a},${i[1]}`},De=(e,t,n,a,l)=>{e?(Oe(t,10),Re(n,10,6),Ue(a,10),l&&Ge(l,10)):(Oe(t,be),Re(n,be),Ue(a,be),l&&Ge(l,be))},Ve=(e,t)=>{const n=e.attr("class",(e=>(e=>{const t=Le(e);return e&&(0===e.depth&&t.push(R.root),e.collapse?t.push(R.collapse):e.children&&0!==e.children.length||t.push("leaf")),t})(e).join(" "))).attr("data-id",Ce);(t?n.transition(t):n).attr("transform",Ee)},Ae=e=>{e.attr("alignment-baseline","text-before-edge").text((e=>e.name||" ")).attr("x",0).attr("dy",((e,t)=>t?e.height:0))},je=(e,t)=>{e.attr("cx",t).attr("cy",0).attr("r",1)},Re=(e,t,n=4)=>{e.attr("x",-t).attr("y",-t).attr("rx",n).attr("ry",n).attr("width",(e=>e.width+2*t)).attr("height",(e=>e.height+2*t))},Ue=(e,t)=>{e.attr("class",R["expand-btn"]).attr("transform",(e=>((e,t)=>{const n=0===e.depth?e.height/2:e.height+3;return`translate(${e.width+t+ge/2+4},${n})`})(e,t))).style("color",(e=>e.color))},Ge=(e,t)=>{e.attr("class",R["add-btn"]).attr("transform",(e=>((e,t)=>{const n=0===e.depth?e.height/2:e.height+3;return`translate(${e.width+t+me/2+8},${n})`})(e,t))).style("visibility",(e=>e.collapse?"hidden":"visible"))},Oe=(e,t)=>{e.attr("class",R.trigger).attr("x",-t).attr("y",-t).attr("width",(e=>e.width+2*t+8+me)).attr("height",(e=>e.height+2*t))},Pe=(e,t)=>{const n=e.attr("stroke",(e=>e.color)).attr("stroke-width",xe);(t?n.transition(t):n).attr("d",(e=>Se(e)))},He=e=>{const t=e.append("tspan");return Ae(t),t},Ke=e=>(Ae(e),e),Ie=e=>{const t=e.append("g");return(e=>{const{side:t,padding:n}=pe,a=-n-t/2,l=t+2*n;e.attr("x",a).attr("y",a).attr("rx",4).attr("ry",4).attr("width",l).attr("height",l)})(t.append("rect")),t.append("path").attr("d",((e,t)=>{const n=-t/2,a=-e/2,l=e/2,o=t/2;return`M${o},${l}H${l}V${o}H${a}V${l}H${n}V${a}H${a}V${n}H${l}V${a}H${o}V${l}Z`})(2,pe.side)),t},qe=e=>{const t=e.append("g");return t.append("rect").attr("x",-ge/2).attr("y",-ve/2).attr("width",ge).attr("height",ve).attr("rx",fe).attr("ry",fe).attr("stroke",(e=>e.color||"grey")).attr("fill",(e=>e.color||"grey")),je(t.append("circle"),-4),je(t.append("circle"),0),je(t.append("circle"),4),t};function Ye(){const e=this.querySelector(`g.${R["add-btn"]}`);e&&(e.style.opacity="1")}function Fe(){const e=this.querySelector(`g.${R["add-btn"]}`);e&&(e.style.opacity="0")}var Je=d({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(e,t){const n=c(!1),a=u();j.on("showContextmenu",(e=>n.value=e));const l=()=>n.value=!1;return{style:a,show:n,close:l,onClick:e=>{l(),t.emit("click-item",e)}}}});var Te={container:"Contextmenu_container_154ic",menu:"Contextmenu_menu_154ic",disabled:"Contextmenu_disabled_154ic"};(Je.__cssModules={}).$style=Te,Je.render=function(e,t,n,a,l,o){return h((x(),m("div",{class:e.style.container},[g("div",{onMousedown:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},null,32),g("div",{id:e.style.menu,style:{top:e.position.top+"px",left:e.position.left+"px"}},[(x(!0),m(v,null,f(e.groups,((t,n)=>(x(),m("ul",{key:n},[(x(!0),m(v,null,f(t,(t=>(x(),m("li",{class:t.disabled?e.style.disabled:"",key:t.name,onClick:n=>e.onClick(t.name)},y(t.title),11,["onClick"])))),128))])))),128))],12,["id"])],2)),[[p,e.show]])};var We=d({name:"Mindmap",components:{Contextmenu:Je},props:{modelValue:{type:Array,required:!0},width:Number,height:Number,xGap:{type:Number,default:50},yGap:{type:Number,default:18},branch:{type:Number,default:4,validator:e=>e>=1&&e<=6},scaleExtent:{default:()=>[.1,8]},centerBtn:Boolean,fitBtn:Boolean,downloadBtn:Boolean,undoBtn:Boolean,addNodeBtn:Boolean,edit:Boolean,drag:Boolean,keyboard:Boolean,contextmenu:Boolean,zoom:Boolean,sharpCorner:Boolean},setup(e){let t=c(z);const n=c({left:0,top:0}),a=c(),o=c(),i=c(),r=c(),s=c(),d=c(),u=c(),h=c(),p=c(),m=c(),g=b().on("zoom",(function(e){if(!h.value)return;t.value=e.transform,h.value.attr("transform",e.transform.toString())})).scaleExtent(e.scaleExtent),v=w().container(se).on("drag",(function(e,t){var n;const a=null==(n=this.parentNode)?void 0:n.parentNode;if(E.value=!1,!h.value)return;O(a,t,[e.x-t.x,e.y-t.y]);const l=k(e,i.value);l[1]+=x.data.y;const o=h.value.selectAll("g.node").filter((e=>{if(e!==t&&e!==t.parent&&!e.id.startsWith(t.id)){const t={x0:e.x-be,x1:e.x+e.width+be,y0:e.y-be,y1:e.y+e.height+be};return l[0]>t.x0&&l[1]>t.y0&&l[0]<t.x1&&l[1]<t.y1}return!1})),r=Array.from(document.getElementsByClassName(R.outline)),s=o.node();r.forEach((e=>{e!==s&&e.classList.remove(R.outline)})),null==s||s.classList.add(R.outline)})).on("end",(function(e,t){var n;const a=null==(n=this.parentNode)?void 0:n.parentNode;E.value=!0;const l=document.getElementsByClassName(R.outline)[0];if(l){l.classList.remove(R.outline);const e=l.getAttribute("data-id");if(!e)throw new Error("outline data-id null");return t.px=0,t.py=0,void ee(e,t.id)}const o=a.parentNode;let i=t,r=t;if(M(o).selectAll(`g.${Le(t).join(".")}`).filter((e=>e!==t)).each((e=>{e.y>t.y&&e.y<t.y+t.py&&e.y>r.y&&(r=e),e.y<t.y&&e.y>t.y+t.py&&e.y<i.y&&(i=e)})),i!==t)return t.px=0,t.py=0,void te(t.id,i.id);if(r!==t)return t.px=0,t.py=0,void te(t.id,r.id,1);O(a,t,[0,0],500)})),f=new ResizeObserver((e=>{if(!m.value)return;const t=e[0],n=t.target,a=2*(parseInt(getComputedStyle(n).paddingLeft||"0",10)+parseInt(getComputedStyle(n.parentNode).borderTopWidth||"0",10));m.value.attr("width",t.contentRect.width+a).attr("height",t.contentRect.height+a)}));let x,y=!1;const E=c(!0),C=$((()=>[[{title:"放大",name:"zoomin",disabled:t.value.k>=e.scaleExtent[1]},{title:"缩小",name:"zoomout",disabled:t.value.k<=e.scaleExtent[0]},{title:"缩放至合适大小",name:"zoomfit",disabled:!1}],[{title:"全选",name:"selectall",disabled:!0}]])),N=c(!0);_((()=>{o.value&&i.value&&r.value&&s.value&&d.value&&(u.value=M(o.value),h.value=M(i.value),p.value=M(r.value).attr("width",0).attr("height",0),m.value=M(s.value),f.observe(d.value),x=new oe(JSON.parse(JSON.stringify(e.modelValue[0])),e.xGap,e.yGap,U),A(),m.value.raise(),d.value.addEventListener("blur",K),d.value.addEventListener("mousedown",(e=>e.stopPropagation())),de(),ue(),u.value.on("mousedown",(()=>{const e=document.getElementsByClassName(R.selected)[0];null==e||e.classList.remove(R.selected)})),J(e.zoom),Z(e.contextmenu))})),B((()=>e.branch),(e=>j.emit("branch",e)),{immediate:!0}),B((()=>e.sharpCorner),(e=>{j.emit("sharp-corner",e),A()})),B((()=>[e.branch,e.addNodeBtn]),(()=>A())),B((()=>[e.xGap,e.yGap]),(e=>{j.emit("gap",e),x.setBoundingBox(e[0],e[1]),A()})),B((()=>[e.drag,e.edit]),(e=>{X(e[0]||e[1]),W(e[0]),T(e[1])})),B((()=>e.zoom),(e=>J(e))),B(E,(e=>{var t;null==(t=h.value)||t.selectAll(`g.${R["add-btn"]}`).style("display",e?"":"none")})),B((()=>e.contextmenu),(e=>Z(e)));const S=e=>{const t=Ie(e);return t.on("click",q),t},D=t=>{var n;const a=!(null==(n=t.data()[0])?void 0:n.depth),l=t.append("g");Ve(l),Pe(l.append("path"));const o=l.append("g").attr("class",R.content),i=o.append("rect"),r=o.append("g").attr("class",R.text),s=r.append("rect"),c=r.append("text").selectAll("tspan").data(Ne).enter().append("tspan");let d;Ae(c),e.addNodeBtn&&(d=S(o));const u=qe(o);return De(a,i,s,u,d),P(l,a),l.each(((e,t)=>{e.children&&A(e.children,l.filter(((e,n)=>t===n)))})),o.raise(),l},V=t=>{var n;const a=!(null==(n=t.data()[0])?void 0:n.depth),l=re(500,L);Ve(t,l),Pe(t.select(":scope > path"),l);const o=t.select(`:scope > g.${R.content}`),i=o.select(":scope > rect"),r=o.select(`g.${R.text}`),s=r.select("rect");r.select("text").selectAll("tspan").data(Ne).join(He,Ke,(e=>e.remove()));let c=o.select(`g.${R["add-btn"]}`),d=o.select(`g.${R["expand-btn"]}`);return e.addNodeBtn?c.node()||(c=S(o)):c.remove(),De(a,i,s,d,c),t.each(((e,n)=>{e.children&&A(e.children,t.filter(((e,t)=>n===t)))})),o.raise(),t},A=(e=[x.data],t=h.value)=>{t.selectAll(`g.${Le(e[0]).join(".")}`).data(e,(e=>e.gKey)).join(D,V)},U=e=>{if(!p.value)throw new Error("asstSvg undefined");const t=ie(e),n=p.value.append("text");n.selectAll("tspan").data(t).enter().append("tspan").text((e=>e)).attr("x",0);const a=n.node().getBBox();return n.remove(),{width:Math.max(a.width,22),height:Math.max(a.height,22)*t.length}};function G(e){const t=e instanceof SVGGElement?e:document.querySelector(`g[data-id='${Ce(e)}']`),n=document.getElementsByClassName(R.selected)[0];if(!t)throw new Error(`g[data-id='${Ce(e)}'] is null`);n?n!==t?(n.classList.remove(R.selected),t.classList.add(R.selected)):y=!0:t.classList.add(R.selected)}const O=(e,t,n,a=0)=>{const l=re(a,L);t.px=n[0],t.py=n[1],M(e).transition(l).attr("transform",Ee),M(`g[data-id='${Ce(t)}'] > path`).transition(l).attr("d",(e=>Se(e)))},P=(t,n)=>{if(t.select(`:scope > g.${R.content} > g.${R["expand-btn"]}`).on("click",F),e.drag||e.edit){const a=t.select(`:scope > g.${R.content} > g.${R.text}`);a.on("mousedown",I),e.drag&&!n&&v(a),e.edit&&a.on("click",H)}e.addNodeBtn&&t.select(`:scope > g.${R.content}`).on("mouseenter",Ye).on("mouseleave",Fe)};function H(e,t){var n,a;const l=null==(n=this.parentNode)?void 0:n.parentNode;if(y&&m.value&&d.value){l.classList.add(R.edited),y=!1,m.value.attr("x",t.x-2).attr("y",t.y-x.data.y-2).attr("data-id",t.id).attr("data-name",t.name).style("display","");const e=d.value;e.textContent=t.name,e.focus(),null==(a=getSelection())||a.selectAllChildren(e)}}const K=()=>{var e;if(null==(e=document.getElementsByClassName(R.edited)[0])||e.classList.remove(R.edited,R.selected),s.value&&d.value){s.value.style.display="none";const e=s.value.getAttribute("data-id"),t=s.value.getAttribute("data-name"),n=d.value.textContent;e&&n&&n!==t&&Q(e,n)}},I=(e,t)=>{e.stopPropagation(),G(t)},q=(e,t)=>{const n=ne(t.id,"");if(!h.value||!n)return;const a=h.value.selectAll(`g[data-id='${Ce(n)}'] g.${R.text}`).node();a&&(y=!0,H.call(a,e,n))},Y=e=>{if(e.preventDefault(),!a.value)return;const t=((e,t)=>{const{pageX:n,pageY:a}=t,l=e.getBoundingClientRect();return{left:n-(l.left+window.pageXOffset),top:a-(l.top+window.pageYOffset)}})(a.value,e);n.value=t;const l=e.composedPath().find((e=>{var t;return null==(t=e.classList)?void 0:t.contains("node")}));if(l){const{classList:e}=l,t=e.contains(R.collapse);e.contains(R.selected)||G(l),j.emit("delete-item",e.contains(R.root)),j.emit("expand-item",!t),j.emit("collapse-item",t||e.contains("leaf"))}N.value=!l,j.emit("showContextmenu",!0)},F=(e,t)=>{le(t.id)},J=e=>{u.value&&(e?(g(u.value),u.value.on("dblclick.zoom",null)):u.value.on(".zoom",null))},T=e=>{if(!d.value||!h.value)return;const t=h.value.selectAll(`g.${R.text}`);e?t.on("click",H):t.on("click",null)},W=e=>{if(!h.value)return;const t=h.value.selectAll(`g.node:not(.${R.root}) > g > g.${R.text}`);e?v(t):t.on(".drag",null)},X=e=>{if(!h.value)return;const t=h.value.selectAll(`g.${R.text}`);e?t.on("mousedown",I):t.on("mousedown",null)},Z=e=>{a.value&&(e?a.value.addEventListener("contextmenu",Y):a.value.removeEventListener("contextmenu",Y))},Q=(e,t)=>{x.rename(e,t),A()},ee=(e,t)=>{x.moveChild(e,t),A()},te=(e,t,n=0)=>{x.moveSibling(e,t,n),A()},ne=(e,t)=>{const n=x.add(e,t);return A(),n},ae=e=>{x.delete(e),A()},le=e=>{x.expand(e),A()},ce=e=>{x.collapse(e),A()},de=()=>{if(!u.value)return;const e=x.data;g.translateTo(u.value,0+e.width/2,0+e.height/2)},ue=()=>{if(!u.value||!i.value||!o.value)return;const e=i.value.getBBox(),t=o.value.getBoundingClientRect(),n=Math.min(t.width/e.width,t.height/e.height),a=t.width/2,l=t.height/2,r=e.width*n/2,s=e.height*n/2,c=z.translate(-e.x*n+a-r,-e.y*n+l-s).scale(n);g.transform(u.value,c)},he=e=>{u.value&&g.scaleBy(u.value,e?1.1:.9)};return{wrapperEle:a,svgEle:o,gEle:i,style:R,asstSvgEle:r,foreignEle:s,foreignDivEle:d,centerView:de,fitView:ue,download:()=>{var e,t;a.value&&(e=a.value,t=x.data.name,l(e).then((e=>{const n=e.toDataURL(),a=open();a&&(a.document.write(`<img src='${n}'>`),a.document.title=t,a.document.close())})))},showViewMenu:N,viewMenu:C,nodeMenu:ze,contextmenuPos:n,onClickMenu:e=>{if("zoomfit"===e)ue();else if("zoomin"===e)he(!0);else if("zoomout"===e)he(!1);else if("add"===e){const e=M(`.${R.selected}`).data()[0];q(new MouseEvent("click"),e)}else if("delete"===e){const e=M(`.${R.selected}`).data()[0];ae(e.id)}else if("collapse"===e){const e=M(`.${R.selected}`).data()[0];ce(e.id)}else if("expand"===e){const e=M(`.${R.selected}`).data()[0];le(e.id)}}}}});const Xe={ref:"gEle"},Ze={ref:"foreignEle",style:{display:"none"}},Qe={ref:"foreignDivEle",contenteditable:""},et={ref:"asstSvgEle"};We.render=function(e,t,n,a,l,o){const i=E("contextmenu");return x(),m("div",{class:e.style.container},[g("div",{id:e.style["svg-wrapper"],ref:"wrapperEle"},[(x(),m("svg",{class:e.style.svg,ref:"svgEle"},[g("g",Xe,[(x(),m("foreignObject",Ze,[g("div",Qe,null,512)],512))],512)],2))],8,["id"]),(x(),m("svg",et,null,512)),g("div",{class:[e.style["button-list"],e.style["right-bottom"]]},[e.centerBtn?(x(),m("button",{key:0,onClick:t[1]||(t[1]=t=>e.centerView())},[g("i",{class:e.style.gps},null,2)])):C("",!0),e.fitBtn?(x(),m("button",{key:1,onClick:t[2]||(t[2]=t=>e.fitView())},[g("i",{class:e.style.fit},null,2)])):C("",!0),e.downloadBtn?(x(),m("button",{key:2,onClick:t[3]||(t[3]=t=>e.download())},[g("i",{class:e.style.download},null,2)])):C("",!0)],2),e.contextmenu?(x(),m(i,{key:0,position:e.contextmenuPos,groups:e.showViewMenu?e.viewMenu:e.nodeMenu,onClickItem:e.onClickMenu},null,8,["position","groups","onClickItem"])):C("",!0)],2)};var tt=d({name:"App",components:{Mindmap:We},setup(){const e=N({"center-btn":{value:!0},"fit-btn":{value:!0},"undo-btn":{value:!1,disabled:!0},"download-btn":{value:!0},"add-node-btn":{value:!0},keyboard:{value:!1,disabled:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},"sharp-corner":{value:!1},vertical:{value:!1,disabled:!0}}),t=N({branch:{value:4,min:1,max:6},"x-gap":{value:50,min:0,max:100},"y-gap":{value:18,min:0,max:100}});return{learn:A,checkboxList:e,rangeList:t}}});const nt={class:"container"},at=g("div",{class:"left-top"},[g("a",{href:"https://github.com/hellowuxin/vue3-mindmap",target:"_blank"},"GitHub")],-1),lt=g("div",{class:"right-top"},[g("span",null,"Props")],-1),ot={class:"right-bottom"};tt.render=function(e,t,n,a,l,o){const i=E("mindmap");return x(),m("div",nt,[at,lt,g(i,{class:"left-bottom",modelValue:e.learn,"onUpdate:modelValue":t[1]||(t[1]=t=>e.learn=t),branch:e.rangeList.branch.value,"x-gap":e.rangeList["x-gap"].value,"y-gap":e.rangeList["y-gap"].value,zoom:e.checkboxList.zoom.value,"fit-btn":e.checkboxList["fit-btn"].value,"center-btn":e.checkboxList["center-btn"].value,"download-btn":e.checkboxList["download-btn"].value,drag:e.checkboxList.drag.value,edit:e.checkboxList.edit.value,"add-node-btn":e.checkboxList["add-node-btn"].value,"sharp-corner":e.checkboxList["sharp-corner"].value,contextmenu:e.checkboxList.contextmenu.value},null,8,["modelValue","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","contextmenu"]),g("div",ot,[(x(!0),m(v,null,f(e.checkboxList,((e,t)=>(x(),m("div",{key:t},[h(g("input",{type:"checkbox",name:t.toString(),"onUpdate:modelValue":t=>e.value=t,disabled:e.disabled},null,8,["name","onUpdate:modelValue","disabled"]),[[S,e.value]]),g("label",{for:t.toString()},y(t),9,["for"])])))),128)),(x(!0),m(v,null,f(e.rangeList,((e,t)=>(x(),m("div",{key:t},[h(g("input",{type:"range",name:t,"onUpdate:modelValue":t=>e.value=t,min:e.min,max:e.max},null,8,["name","onUpdate:modelValue","min","max"]),[[D,e.value,void 0,{number:!0}]]),g("label",{for:t},y(t)+"（"+y(e.value)+"）",9,["for"])])))),128))])])},V(tt).mount("#app");
