import{m as t,r as e,p as n,s as a,c as l,l as s,a as i,b as o,z as r,d as c,i as d,e as h,t as u,h as p,f as g,g as m,o as f,P as v,j as b,k as y,u as x,n as w,q as _,w as $,v as k,x as M,y as B,F as L,A as S,B as C,C as E,D,E as N,G as z,H as A,I as V,J as P,K as G,L as j}from"./vendor.2469ff34.js";var K=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",get svg(){return ot},get g(){return rt},get asstSvg(){return ct},get foreign(){return dt}}),H=[{name:"如何学习D3",children:[{name:"预备知识",children:[{name:"HTML & CSS"},{name:"JavaScript"},{name:"DOM"},{name:"SVG"},{name:"test\ntest"}]},{name:"安装",collapse:!0,children:[{name:"折叠节点"}]},{name:"入门",children:[{name:"选择集"},{name:"test"},{name:"绑定数据"},{name:"添加删除元素"},{name:"简单图形",children:[{name:"柱形图"},{name:"折线图"},{name:"散点图"}]},{name:"比例尺"},{name:"生成器"},{name:"过渡"}],left:!0},{name:"进阶",left:!0},{name:"一级节点",children:[{name:"子节点1"},{name:"子节点2"},{name:"子节点3"}]}]}];const O=t();var W={container:"Mindmap_container_fgvb6","svg-wrapper":"Mindmap_svg-wrapper_fgvb6","asst-svg":"Mindmap_asst-svg_fgvb6",svg:"Mindmap_svg_fgvb6",trigger:"Mindmap_trigger_fgvb6",dragging:"Mindmap_dragging_fgvb6","add-btn":"Mindmap_add-btn_fgvb6",hidden:"Mindmap_hidden_fgvb6","expand-btn":"Mindmap_expand-btn_fgvb6",text:"Mindmap_text_fgvb6",selected:"Mindmap_selected_fgvb6",content:"Mindmap_content_fgvb6",root:"Mindmap_root_fgvb6",edited:"Mindmap_edited_fgvb6",outline:"Mindmap_outline_fgvb6",collapse:"Mindmap_collapse_fgvb6","button-list":"Mindmap_button-list_fgvb6","right-bottom":"Mindmap_right-bottom_fgvb6","right-top":"Mindmap_right-top_fgvb6",disabled:"Mindmap_disabled_fgvb6",gps:"Mindmap_gps_fgvb6",fit:"Mindmap_fit_fgvb6",download:"Mindmap_download_fgvb6",prev:"Mindmap_prev_fgvb6",next:"Mindmap_next_fgvb6",close:"Mindmap_close_fgvb6"};const Y=e(),I=e(),R=e(),T=e(),q=e(),F=e();function U(){const t=this.querySelector(`g.${W["add-btn"]}`);t&&(t.style.opacity="1")}function J(){const t=this.querySelector(`g.${W["add-btn"]}`);t&&(t.style.opacity="0")}const X=(t,e)=>{t.stopPropagation(),ee(e)};function Z(t,e){var n,a;const l=null==(n=this.parentNode)?void 0:n.parentNode,{foreign:s}=K;if(zt&&s&&F.value){l.classList.add(W.edited),O.emit("edit-flag",!1),s.attr("x",e.x-2-(e.left?e.width:0)).attr("y",e.y-on.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const t=F.value;t.textContent=e.name,t.focus(),null==(a=getSelection())||a.selectAllChildren(t);const n=l.querySelector(`:scope > .${W.content}`);n&&oe(n)}}const Q=()=>{var t;if(null==(t=document.getElementsByClassName(W.edited)[0])||t.classList.remove(W.edited,W.selected),q.value&&F.value){q.value.style.display="none";const t=q.value.getAttribute("data-id"),e=q.value.getAttribute("data-name"),n=F.value.textContent;t&&null!==n&&n!==e&&cn(t,n)}},tt=t=>{if(t.preventDefault(),!Y.value)return;const e=te(Y.value,t);ut.value=e;const n=t.composedPath().find((t=>{var e;return null==(e=t.classList)?void 0:e.contains("node")}));if(n){const{classList:t}=n,e=t.contains(W.root),a=t.contains(W.collapse);t.contains(W.selected)||ee(n),ft.value.disabled=a,mt.value.disabled=e,bt.value.disabled=e,yt.value.disabled=e,vt.value.disabled=e,gt.value.disabled=!a,pt.value.disabled=a||t.contains("leaf"),ht.value=!1}else ht.value=!0;O.emit("showContextmenu",!0)},et=t=>{var e;switch(t){case"zoomfit":ie();break;case"zoomin":case"zoomout":re(!0);break;case"add":nt(new MouseEvent("click"),ne());break;case"delete":pn(ne().id);break;case"collapse":mn(ne().id);break;case"expand":gn(ne().id);break;case"add-sibling":{const t=ne(),e=fn(t.id,"");e&&at(e)}break;case"add-sibling-before":{const t=ne(),e=fn(t.id,"",!0);e&&at(e)}break;case"add-parent":{const t=ne(),e=vn(t.id,"");e&&at(e)}break;case"copy":{const t=ne(),n=null==(e=on.find(t.id))?void 0:e.rawData;n&&navigator.clipboard.writeText(JSON.stringify(n))}break;case"paste":{const t=ne();navigator.clipboard.readText().then((e=>{const n=ue(e)||{name:e};un(t.id,n)}))}}},nt=(t,e)=>{const n=un(e.id,"");n&&at(n,t)};function at(t,e=new MouseEvent("click")){const{g:n}=K;if(!n)return;const a=n.selectAll(`g[data-id='${me(t)}'] > g.${W.content} > g.${W.text}`).node();a&&(O.emit("edit-flag",!0),Z.call(a,e,t))}const lt=(t,e)=>{gn(e.id)};const st=t=>{const{svg:e}=K;e&&(t?(It(e),e.on("dblclick.zoom",null)):e.on(".zoom",null))},it=t=>{Y.value&&(t?Y.value.addEventListener("contextmenu",tt):Y.value.removeEventListener("contextmenu",tt))};let ot,rt,ct,dt;O.on("selection-svg",(t=>ot=t)),O.on("selection-g",(t=>rt=t)),O.on("selection-asstSvg",(t=>ct=t)),O.on("selection-foreign",(t=>dt=t));const ht=e(!0),ut=e({left:0,top:0}),pt=e({title:"折叠节点",name:"collapse",disabled:!0}),gt=e({title:"展开节点",name:"expand",disabled:!0}),mt=e({title:"删除节点",name:"delete",disabled:!1}),ft=e({title:"新建子节点",name:"add",disabled:!1}),vt=e({title:"新建父节点",name:"add-parent",disabled:!1}),bt=e({title:"新建兄弟节点",name:"add-sibling",disabled:!1}),yt=e({title:"在此之前新建兄弟节点",name:"add-sibling-before",disabled:!0}),xt=e({title:"拷贝",name:"copy",disabled:!1}),wt=e({title:"粘贴",name:"paste",disabled:!1}),_t=l((()=>[[ft.value,vt.value,bt.value,yt.value],[xt.value,wt.value,mt.value],[{title:"全选",name:"selectall",disabled:!0}],[pt.value,gt.value]])),$t=l((()=>[[{title:"放大",name:"zoomin",disabled:Yt.value.k>=Nt[1]},{title:"缩小",name:"zoomout",disabled:Yt.value.k<=Nt[0]},{title:"缩放至合适大小",name:"zoomfit",disabled:!1}],[{title:"全选",name:"selectall",disabled:!0}]])),kt=l((()=>ht.value?$t.value:_t.value)),Mt=s().source((t=>t.source)).target((t=>t.target)),Bt=i().curve(o),Lt=({source:t,target:e})=>Bt([t,e]);let St=!1,Ct=Mt;const Et=e(!1);O.on("sharp-corner",(t=>{St!==t&&(Et.value=!0),St=!!t,Ct=t?Lt:Mt}));let Dt=4;O.on("branch",(t=>Dt=t||Dt));let Nt=[.1,8];O.on("scale-extent",(t=>Nt=t||Nt));let zt=!1;O.on("edit-flag",(t=>zt=!!t));let At=18,Vt=84,Pt=Math.min(At/2-1,10);O.on("gap",(t=>{t&&(Vt=t.xGap,At=t.yGap,Pt=Math.min(At/2-1,10),Pt=Math.min(Vt/2-1,Pt))}));const Gt=new ResizeObserver((t=>{const{foreign:e}=K;if(!e)return;const n=t[0],a=n.target,{width:l,height:s}=n.contentRect,i=2*(parseInt(getComputedStyle(a).paddingLeft||"0",10)+parseInt(getComputedStyle(a.parentNode).borderTopWidth||"0",10));e.attr("width",l+i).attr("height",s+i),"none"!==e.style("display")&&oe(a)})),jt={side:12,padding:2,margin:8},Kt=jt.side+2*jt.padding,Ht=16,Ot=4,Wt=2,Yt=e(d),It=r().on("zoom",(t=>{const{g:e}=K;e&&(Yt.value=t.transform,e.attr("transform",t.transform.toString()))})).scaleExtent(Nt),Rt=c().container((function(){var t,e;return null==(e=null==(t=this.parentNode)?void 0:t.parentNode)?void 0:e.parentNode})).on("drag",(function(t,e){var a;const l=null==(a=this.parentNode)?void 0:a.parentNode;I.value&&I.value.classList.add(W.dragging);const{g:s}=K;if(!s)return;le(l,e,[t.x-e.x,t.y-e.y]);const i=n(t,R.value);i[1]+=on.data.y;const o=s.selectAll("g.node").filter((t=>{if(t!==e&&t!==e.parent&&!t.id.startsWith(e.id)){let e=Pt,n=t.width+Pt;t.left&&0!==t.depth&&([e,n]=[n,e]);const a={x0:t.x-e,x1:t.x+n,y0:t.y-Pt,y1:t.y+t.height+Pt};return i[0]>a.x0&&i[1]>a.y0&&i[0]<a.x1&&i[1]<a.y1}return!1})),r=Array.from(document.getElementsByClassName(W.outline)),c=o.node();r.forEach((t=>{t!==c&&t.classList.remove(W.outline)})),null==c||c.classList.add(W.outline)})).on("end",(function(t,e){var n;const l=null==(n=this.parentNode)?void 0:n.parentNode;I.value&&I.value.classList.remove(W.dragging);const s=document.getElementsByClassName(W.outline)[0];if(s){s.classList.remove(W.outline);const t=s.getAttribute("data-id");if(!t)throw new Error("outline data-id null");return e.px=0,e.py=0,void dn(t,e.id)}const i=e.x-on.getRootWidth()/2,o=1===e.depth&&i*(i+e.px)<0,r=o?t=>t.left!==e.left:t=>t.left===e.left,c=l.parentNode;let d=o?{y:1/0,id:e.id}:e,h=o?{y:-1/0,id:e.id}:e;const u=a(c).selectAll(`g.${pe(e).join(".")}`).filter((t=>t!==e&&r(t))),p=e.y+e.py;u.each((t=>{(o||t.y>e.y)&&t.y<p&&t.y>h.y&&(h=t),(o||t.y<e.y)&&t.y>p&&t.y<d.y&&(d=t)})),d.id!==e.id?(e.px=0,e.py=0,hn(e.id,d.id)):h.id!==e.id?(e.px=0,e.py=0,hn(e.id,h.id,1)):o?(e.px=0,e.py=0,bn(e.id)):le(l,e,[0,0],500)})),Tt=e(!1);let qt;O.on("mindmap-context",(t=>t?qt=t:null));const Ft={drag:!1,edit:!1};const Ut=new class{constructor(t=20){this.length=t,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(t){const e=h.cloneDeep(t);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(e),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,h.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,h.cloneDeep(this.snapshots[this.cursor])):null}},Jt=e(!1),Xt=e(!1),Zt=t=>{const e=t.split("\n");return e.length>2&&""===e[e.length-1]&&e.pop(),e},Qt=(t,e)=>u().duration(t).ease(e),te=(t,e)=>{const{pageX:n,pageY:a}=e,l=t.getBoundingClientRect();return{left:n-(l.left+window.pageXOffset),top:a-(l.top+window.pageYOffset)}};function ee(t){const e=t instanceof SVGGElement?t:document.querySelector(`g[data-id='${me(t)}']`),n=document.getElementsByClassName(W.selected)[0];if(!e)throw new Error("selectGNode failed");n?n!==e?(n.classList.remove(W.selected),e.classList.add(W.selected)):O.emit("edit-flag",!0):e.classList.add(W.selected)}function ne(){return a(`.${W.selected}`).data()[0]}const ae=t=>{const{asstSvg:e}=K;if(!e)throw new Error("asstSvg undefined");const n=Zt(t),a=e.append("text");a.selectAll("tspan").data(n).enter().append("tspan").text((t=>t)).attr("x",0);const l=a.node().getBBox();return a.remove(),{width:Math.max(l.width,22),height:Math.max(l.height,22)*n.length}},le=(t,e,n,l=0)=>{const s=Qt(l,g);e.px=n[0],e.py=n[1],a(t).transition(s).attr("transform",ge),a(`g[data-id='${me(e)}'] > path`).transition(s).attr("d",(t=>ve(t)))},se=()=>{const{svg:t}=K;if(!t)return;const e=on.data;It.translateTo(t,0+e.width/2,0+e.height/2)},ie=()=>{const{svg:t}=K;if(!t||!R.value||!I.value)return;const e=R.value.getBBox(),n=I.value.getBoundingClientRect(),a=Math.min(n.width/e.width,n.height/e.height),l=n.width/2,s=n.height/2,i=e.width*a/2,o=e.height*a/2,r=d.translate(-e.x*a+l-i,-e.y*a+s-o).scale(a);It.transform(t,r)},oe=t=>{const{svg:e}=K;if(e&&I.value){const{k:n}=Yt.value,a=t.getBoundingClientRect(),{x:l,y:s,width:i,height:o}=I.value.getBoundingClientRect(),r=a.x-l,c=r+a.width,d=a.y-s,h=d+a.height,u=2;let p=0,g=0;r<0&&(p=-r/n+u),(a.width>i||c>i)&&(p=-(c-i)/n-u),d<0&&(g=-d/n+u),(a.height>o||h>o)&&(g=-(h-o)/n-u),It.translateBy(e,p,g)}},re=t=>{const{svg:e}=K;e&&It.scaleBy(e,t?1.1:.9)},ce=()=>{var t,e;Y.value&&(t=Y.value,e=on.data.name,p(t).then((t=>{const n=t.toDataURL(),a=open();a&&(a.document.write(`<img src='${n}'>`),a.document.title=e,a.document.close())})))},de=()=>{const t=Ut.next();t&&(on.data=t,rn(!1))},he=()=>{const t=Ut.prev();t&&(on.data=t,rn(!1))},ue=t=>{let e;try{return e=JSON.parse(t),"name"in e&&e}catch(n){return!1}},pe=t=>{const e=["node"];return t&&e.push(`depth-${t.depth}`),e},ge=t=>`translate(${t.dx+t.px},${t.dy+t.py})`,me=t=>t.id,fe=t=>{const e=Zt(t.name),n=t.height/e.length;return e.map((t=>({name:t,height:n})))},ve=t=>{let e=0,n=0;const a=Math.max(Pt-3,0);let l=t.width+a;let s=3;const{parent:i}=t;i&&(e=i.width,n=i.height,0===i.depth&&(St||(e/=2),n/=2,s=0)),t.left&&(i&&(0!==i.depth?e=-e:St&&(e=0)),l=-l);const o=[-t.dx+e-t.px,-t.dy+n+s-t.py],r=[0,t.height+3];return`${Ct({source:o,target:r})}L${l},${r[1]}`},be=(t,e,n,a,l)=>{t?(Be(e,10),$e(n,10,6),ke(a,10),l&&Me(l,10)):(Be(e,Pt),$e(n,Pt),ke(a,Pt),l&&Me(l,Pt))},ye=(t,e)=>{const n=t.attr("class",(t=>(t=>{const e=pe(t);return t&&(0===t.depth&&e.push(W.root),t.collapse?e.push(W.collapse):t.children&&0!==t.children.length||e.push("leaf")),e})(t).join(" "))).attr("data-id",me);(e?n.transition(e):n).attr("transform",ge)},xe=(t,e)=>{(e?t.transition(e):t).attr("transform",(t=>`translate(${t.left?-t.width:0},0)`))},we=t=>{t.attr("alignment-baseline","text-before-edge").text((t=>t.name||" ")).attr("x",0).attr("dy",((t,e)=>e?t.height:0))},_e=(t,e)=>{t.attr("cx",e).attr("cy",0).attr("r",1)},$e=(t,e,n=4)=>{t.attr("x",(t=>-e-(t.left?t.width:0))).attr("y",-e).attr("rx",n).attr("ry",n).attr("width",(t=>t.width+2*e)).attr("height",(t=>t.height+2*e))},ke=(t,e)=>{t.attr("class",W["expand-btn"]).attr("transform",(t=>((t,e)=>{const n=0===t.depth?t.height/2:t.height+3;let a=t.width+e+Ht/2+4;return t.left&&(a=-a),`translate(${a},${n})`})(t,e))).style("color",(t=>t.color))},Me=(t,e)=>{t.attr("class",(t=>(t=>{const e=[W["add-btn"]];return t.collapse&&e.push(W.hidden),e})(t).join(" "))).attr("transform",(t=>((t,e)=>{const n=0===t.depth?t.height/2:t.height+3;let a=t.width+e+Kt/2+jt.margin;return t.left&&(a=-a),`translate(${a},${n})`})(t,e)))},Be=(t,e)=>{const n=Kt+jt.margin,a=2*e;t.attr("class",W.trigger).attr("x",(t=>-e-(t.left?t.width+n:0))).attr("y",-e).attr("width",(t=>t.width+a+n)).attr("height",(t=>t.height+a))},Le=(t,e)=>{const n=t.attr("stroke",(t=>t.color)).attr("stroke-width",Dt);if(e){const t=n.transition(e);Et.value?t.attrTween("d",Se):t.attr("d",ve)}else n.attr("d",ve)};function Se(t,e,n){const a=ve(t),l=n[e],s=l.cloneNode(),i=l.getTotalLength();s.setAttribute("d",a);const o=s.getTotalLength(),r=[0],c=10/Math.max(i,o);let d=0;for(;(d+=c)<1;)r.push(d);r.push(1);const h=r.map((t=>{const e=l.getPointAtLength(t*i),n=s.getPointAtLength(t*o);return m([e.x,e.y],[n.x,n.y])}));return t=>t<1?"M"+h.map((e=>e(t))).join("L"):a}const Ce=t=>{const e=t.append("tspan");return we(e),e},Ee=t=>(we(t),t),De=t=>{const e=t.append("g");return(t=>{const{side:e,padding:n}=jt,a=-n-e/2,l=e+2*n;t.attr("x",a).attr("y",a).attr("rx",4).attr("ry",4).attr("width",l).attr("height",l)})(e.append("rect")),e.append("path").attr("d",((t,e)=>{const n=-e/2,a=-t/2,l=t/2,s=e/2;return`M${s},${l}H${l}V${s}H${a}V${l}H${n}V${a}H${a}V${n}H${l}V${a}H${s}V${l}Z`})(2,jt.side)),e},Ne=t=>{const e=De(t);return e.on("click",nt),e},ze=t=>{const e=t.append("g");return e.append("rect").attr("x",-Ht/2).attr("y",-Ot/2).attr("width",Ht).attr("height",Ot).attr("rx",Wt).attr("ry",Wt).attr("stroke",(t=>t.color||"grey")).attr("fill",(t=>t.color||"grey")),_e(e.append("circle"),-4),_e(e.append("circle"),0),_e(e.append("circle"),4),e},Ae=t=>{var e;const n=!(null==(e=t.data()[0])?void 0:e.depth),a=t.append("g");ye(a),Le(a.append("path"));const l=a.append("g").attr("class",W.content),s=l.append("rect"),i=l.append("g").attr("class",W.text),o=i.append("rect"),r=i.append("text");xe(r);const c=r.selectAll("tspan").data(fe).enter().append("tspan");let d;we(c),Tt.value&&(d=Ne(l));const h=ze(l);return be(n,s,o,h,d),((t,e)=>{if(t.select(`:scope > g.${W.content} > g.${W["expand-btn"]}`).on("click",lt),Ft.drag||Ft.edit){const n=t.select(`:scope > g.${W.content} > g.${W.text}`);n.on("mousedown",X),Ft.drag&&!e&&Rt(n),Ft.edit&&n.on("click",Z)}Tt.value&&t.select(`:scope > g.${W.content}`).on("mouseenter",U).on("mouseleave",J)})(a,n),a.each(((t,e)=>{t.children&&Pe(t.children,a.filter(((t,n)=>e===n)))})),l.raise(),a},Ve=t=>{var e;const n=!(null==(e=t.data()[0])?void 0:e.depth),a=Qt(500,g);ye(t,a),Le(t.select(":scope > path"),a);const l=t.select(`:scope > g.${W.content}`),s=l.select(":scope > rect"),i=l.select(`g.${W.text}`),o=i.select("rect"),r=i.select("text");xe(r,a),r.selectAll("tspan").data(fe).join(Ce,Ee,(t=>t.remove()));let c=l.select(`g.${W["add-btn"]}`);const d=l.select(`g.${W["expand-btn"]}`);return Tt.value?c.node()||(c=Ne(l)):c.remove(),be(n,s,o,d,c),t.each(((e,n)=>{e.children&&Pe(e.children,t.filter(((t,e)=>n===e)))})),l.raise(),t},Pe=(t=[on.data],e=rt)=>{e.selectAll(`g.${pe(t[0]).join(".")}`).data(t,(t=>t.gKey)).join(Ae,Ve)};class Ge{constructor(t,e,n,a){this.w=t,this.h=e,this.y=n,this.c=a,this.cs=a.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function je(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function Ke(t){return t.y+t.h}class He{constructor(t,e,n){this.lowY=t,this.index=e,this.next=n}}function Oe(t,e,n){for(;null!==n&&t>=n.lowY;)n=n.next;return new He(t,e,n)}function We(t,e,n,a){t.c[e].mod+=a,t.c[e].msel+=a,t.c[e].mser+=a,function(t,e,n,a){if(n!==e-1){const l=e-n;t.c[n+1].shift+=a/l,t.c[e].shift-=a/l,t.c[e].change-=a-a/l}}(t,e,n,a)}function Ye(t){return 0===t.cs?t.tl:t.c[0]}function Ie(t){return 0===t.cs?t.tr:t.c[t.cs-1]}function Re(t,e,n){let a=t.c[e-1],l=a.mod,s=t.c[e],i=s.mod;for(;null!==a&&null!==s;){Ke(a)>n.lowY&&(n=n.next);const o=l+a.prelim+a.w-(i+s.prelim);o>0&&(i+=o,We(t,e,n.index,o));const r=Ke(a),c=Ke(s);r<=c&&(a=Ie(a),null!==a&&(l+=a.mod)),r>=c&&(s=Ye(s),null!==s&&(i+=s.mod))}null===a&&null!==s?function(t,e,n,a){const l=t.c[0].el;l.tl=n;const s=a-n.mod-t.c[0].msel;l.mod+=s,l.prelim-=s,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,s,i):null!==a&&null===s&&function(t,e,n,a){const l=t.c[e].er;l.tr=n;const s=a-n.mod-t.c[e].mser;l.mod+=s,l.prelim-=s,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,a,l)}function Te(t){if(0===t.cs)return void je(t);Te(t.c[0]);let e=Oe(Ke(t.c[0].el),0,null);for(let n=1;n<t.cs;n++){Te(t.c[n]);const a=Ke(t.c[n].er);Re(t,n,e),e=Oe(a,n,e)}!function(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}(t),je(t)}function qe(t,e){e+=t.mod,t.x=t.prelim+e,function(t){let e=0,n=0;for(let a=0;a<t.cs;a++)e+=t.c[a].shift,n+=e+t.c[a].change,t.c[a].mod+=n}(t);for(let n=0;n<t.cs;n++)qe(t.c[n],e)}function Fe(t){Te(t),qe(t,0)}class Ue{constructor(t,e){this.gap=t,this.bottomPadding=e}addBoundingBox(t,e){return{width:t+this.gap,height:e+this.bottomPadding}}removeBoundingBox(t,e){return{x:t+this.gap/2,y:e}}}class Je{constructor(t){this.bb=t}layout(t){const e=this.convert(t);Fe(e);const{boundingBox:n,result:a}=this.assignLayout(e,t);return{result:a,boundingBox:n}}convert(t,e=0){const{width:n,height:a}=this.bb.addBoundingBox(t.width,t.height),l=[];if(t.children&&t.children.length)for(let s=0;s<t.children.length;s++)l[s]=this.convert(t.children[s],e+a);return new Ge(n,a,e,l)}assignCoordinates(t,e){const{x:n,y:a}=this.bb.removeBoundingBox(t.x,t.y);e.x=n,e.y=a;for(let l=0;l<t.c.length;l++)this.assignCoordinates(t.c[l],e.children[l])}getSize(t,e){const{x:n,y:a,width:l,height:s}=t;if(e||(e={left:n,right:n+l,top:a,bottom:a+s}),e.left=Math.min(e.left,n),e.right=Math.max(e.right,n+l),e.top=Math.min(e.top,a),e.bottom=Math.max(e.bottom,a+s),t.children)for(const i of t.children)this.getSize(i,e);return e}assignLayout(t,e,n){const{x:a,y:l}=this.bb.removeBoundingBox(t.x,t.y);e.x=a,e.y=l;const{width:s,height:i}=e;n||(n={left:a,right:a+s,top:l,bottom:l+i}),n.left=Math.min(n.left,a),n.right=Math.max(n.right,a+s),n.top=Math.min(n.top,l),n.bottom=Math.max(n.bottom,l+i);for(let o=0;o<t.c.length;o++)this.assignLayout(t.c[o],e.children[o],n);return{result:e,boundingBox:n}}}const Xe=t=>[t.width,t.height]=[t.height,t.width],Ze=t=>{t.parent?(t.dx=t.x-t.parent.x,t.dy=t.y-t.parent.y):(t.dx=0,t.dy=0)},Qe=(t,e)=>t.id=e,tn=t=>{t.parent?t.depth=t.parent.depth+1:t.depth=0},en=t=>{t.parent&&t.parent.color&&(t.color=t.parent.color)},nn=t=>{t.depth>1&&t.parent&&(t.left=t.parent.left)},an=(t,e,n="0")=>{var a;e.forEach((e=>{e(t,n)}));const{children:l}=t;if(l)for(let s=0;s<l.length;){const i=l[s];"del"===i.id?(l.splice(s,1),null==(a=t.rawData.children)||a.splice(s,1)):(an(i,e,`${n}-${s}`),s+=1)}},ln=(t,e)=>{const n=new Ue(e,t);return new Je(n)};class sn{constructor(t,e,n,a,l=f(v)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.colorScale=l,this.getSize=a,this.layout=ln(e,n),this.data=this.createMdataFromData(t,"0"),this.renew()}createMdataFromData(t,e,n=null){const{name:a,collapse:l,children:s}=t,{width:i,height:o}=this.getSize(a),r=n?n.depth+1:0;let c=!1,d=n?n.color:"";1===r?(c=!!t.left,d=this.colorScale(`${this.colorNumber+=1}`)):0!==r&&n&&(c=n.left);const h={id:e,name:a,rawData:t,parent:n,left:c,color:d,depth:r,x:0,y:0,dx:0,dy:0,px:0,py:0,width:i,height:o,children:[],_children:[],collapse:!!l,gKey:this.gKey+=1};return s&&(h.collapse?s.forEach(((t,n)=>{h._children.push(this.createMdataFromData(t,`${e}-${n}`,h))})):s.forEach(((t,n)=>{h.children.push(this.createMdataFromData(t,`${e}-${n}`,h))}))),h}renew(...t){an(this.data,[Xe,nn]),this.data=this.l(this.data);const e=[Xe,this.renewXY.bind(this),Ze];an(this.data,e.concat(t))}l(t){const{left:e,right:n}=(t=>{const e=Object.assign({},t),n=Object.assign({},t);if(t.collapse);else{const{children:a}=t;e.children=[],n.children=[],a.forEach((t=>{t.left?e.children.push(t):n.children.push(t),t.parent&&(t.parent=n)}))}return{left:e,right:n}})(t);return this.layout.layout(e),this.layout.layout(n),this.diffY=n.x-e.x,this.rootWidth=e.height,n.children=t.children,n}renewXY(t){[t.x,t.y]=[t.y,t.x],t.left&&(t.x=-t.x+this.rootWidth,t.y+=this.diffY)}getRootWidth(){return this.rootWidth}setBoundingBox(t,e){this.layout=ln(t,e),this.renew()}find(t){const e=t.split("-").map((t=>~~t));let n=this.data;for(let a=1;a<e.length;a++){const t=e[a],{children:l}=n;if(!(t<l.length))return null;n=l[t]}return n.id===t?n:null}rename(t,e){if(t.length>0){const n=this.find(t);if(n&&n.name!==e){n.name=e,n.rawData.name=e;const t=this.getSize(n.name);n.width=t.width,n.height=t.height,this.renew()}return n}return null}moveChild(t,e){var n,a;if(t===e)return null;const l=this.find(t),s=this.find(e),i=e.split("-").pop();if(i&&l&&s){const t=s.parent;null==(n=null==t?void 0:t.children)||n.splice(~~i,1),null==(a=null==t?void 0:t.rawData.children)||a.splice(~~i,1),s.parent=l,s.gKey=this.gKey+=1,s.depth=s.parent.depth+1,1===s.depth?s.color=this.colorScale(`${this.colorNumber+=1}`):s.left=s.parent.left,l.collapse?l._children.push(s):l.children.push(s),l.rawData.children?l.rawData.children.push(s.rawData):l.rawData.children=[s.rawData],this.renew(Qe,en,tn)}return s}moveSibling(t,e,n=0){const a=t.split("-"),l=e.split("-");let s=a.pop(),i=l.pop();if(t===e||a.length!==l.length||!s||!i)return null;const o=this.find(t),r=this.find(e);if(r&&o&&o.parent){s=parseInt(s,10),i=parseInt(i,10),s<i&&(i-=1);const{children:t}=o.parent,{children:e}=o.parent.rawData;if(t&&e)return t.splice(s,1),t.splice(i+n,0,o),e.splice(s,1),e.splice(i+n,0,o.rawData),1===o.depth&&(o.left=r.left),this.renew(Qe),o}return null}add(t,e){const n=this.find(t);if(n&&!n.collapse){if(n.children||(n.children=[]),n.rawData.children||(n.rawData.children=[]),"string"==typeof e){const t=e,a=this.getSize(t),l={name:t},s=n.color?n.color:this.colorScale(`${this.colorNumber+=1}`),i={id:`${n.id}-${n.children.length}`,name:t,rawData:l,parent:n,left:n.left,collapse:!1,color:s,gKey:this.gKey+=1,width:a.width,height:a.height,depth:n.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return n.children.push(i),n.rawData.children.push(l),this.renew(),i}{const t=e,a=this.createMdataFromData(t,`${n.id}-${n.children.length}`,n);return n.children.push(a),n.rawData.children.push(t),this.renew(),a}}return null}expand(t){return this.eoc(t,!1,[en,Qe])}collapse(t){return this.eoc(t,!0)}eoc(t,e,n=[]){const a=this.find(t);return a&&(a.collapse=e,a.rawData.collapse=e,[a._children,a.children]=[a.children,a._children],this.renew(...n)),a}delete(t){const e=t.split("-");if(!(e.length>=2))throw new Error("暂不支持删除根节点");{const t=e.pop(),n=this.find(e.join("-"));t&&n&&n.children&&(n.children[~~t].id="del"),this.renew(Qe)}}addSibling(t,e,n=!1){var a;const l=this.find(t);if(l&&l.parent){const s=parseInt(t.split("-").pop(),10),{parent:i,left:o}=l,r={name:e,left:o},c=this.getSize(e),d=n?s:s+1,h={name:e,parent:i,children:[],_children:[],color:i.color?i.color:this.colorScale(`${this.colorNumber+=1}`),collapse:!1,rawData:r,id:`${i.id}-${d}`,left:o,gKey:this.gKey+=1,depth:l.depth,width:c.width,height:c.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return i.children.splice(d,0,h),null==(a=i.rawData.children)||a.splice(d,0,r),this.renew(Qe),h}return null}addParent(t,e){var n;const a=this.find(t);if(a&&a.parent){const{parent:t,left:l,color:s}=a,i=this.getSize(e),o=parseInt(a.id.split("-").pop(),10),r={name:e,children:[a.rawData],left:l};null==(n=t.rawData.children)||n.splice(o,1,r);const c={rawData:r,left:l,name:e,color:s,collapse:!1,parent:t,id:a.id,depth:a.depth,width:i.width,height:i.height,gKey:this.gKey+=1,children:[a],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return a.parent=c,t.children.splice(o,1,c),this.renew(Qe,tn),c}return null}changeLeft(t){const e=this.find(t);return e&&(e.left=!e.left,this.renew()),e}}let on;O.on("mmdata",(t=>t?on=t:null));const rn=(t=!0)=>{t&&Ut.snap(on.data),qt.emit("update:modelValue",b([on.data.rawData])),Jt.value=Ut.hasPrev,Xt.value=Ut.hasNext,Pe()},cn=(t,e)=>{on.rename(t,e),rn()},dn=(t,e)=>{on.moveChild(t,e),rn()},hn=(t,e,n=0)=>{on.moveSibling(t,e,n),rn()},un=(t,e)=>{const n=on.add(t,e);return rn(),n},pn=t=>{on.delete(t),rn()},gn=t=>{on.expand(t),rn()},mn=t=>{on.collapse(t),rn()},fn=(t,e,n=!1)=>{const a=on.addSibling(t,e,n);return rn(),a},vn=(t,e)=>{const n=on.addParent(t,e);return rn(),n},bn=t=>{on.changeLeft(t),rn()};var yn=y({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(t,n){const a=e(!1),l=x(),s=e(),i=e(),o=w({top:0,left:0});O.on("showContextmenu",(async e=>{if(!s.value||!i.value)return;a.value=!!e,await _();const{offsetWidth:n,offsetHeight:l}=s.value,{offsetWidth:r,offsetHeight:c}=i.value,{top:d,left:h}=t.position;o.top=d+c>l?l-c-8:d,o.left=h+r>n?h-r:h}));const r=()=>a.value=!1;return{style:l,show:a,close:r,onClick:t=>{r(),n.emit("click-item",t)},menuEle:i,containerEle:s,pos:o}}});var xn={container:"Contextmenu_container_154ic",menu:"Contextmenu_menu_154ic",disabled:"Contextmenu_disabled_154ic"};(yn.__cssModules={}).$style=xn,yn.render=function(t,e,n,a,l,s){return $((C(),M("div",{class:t.style.container,ref:"containerEle"},[B("div",{onMousedown:e[1]||(e[1]=(...e)=>t.close&&t.close(...e))},null,32),B("div",{ref:"menuEle",id:t.style.menu,style:{top:t.pos.top+"px",left:t.pos.left+"px"}},[(C(!0),M(L,null,S(t.groups,((e,n)=>(C(),M("ul",{key:n},[(C(!0),M(L,null,S(e,(e=>(C(),M("li",{class:e.disabled?t.style.disabled:"",key:e.name,onClick:n=>t.onClick(e.name)},E(e.title),11,["onClick"])))),128))])))),128))],12,["id"])],2)),[[k,t.show]])};var wn=y({name:"Mindmap",components:{Contextmenu:yn},props:{modelValue:{type:Array,required:!0},xGap:{type:Number,default:Vt},yGap:{type:Number,default:At},branch:{type:Number,default:Dt,validator:t=>t>=1&&t<=6},scaleExtent:{type:Object,default:Nt},sharpCorner:Boolean,centerBtn:Boolean,fitBtn:Boolean,downloadBtn:Boolean,timetravel:Boolean,addNodeBtn:Boolean,edit:Boolean,drag:Boolean,keyboard:Boolean,ctm:Boolean,zoom:Boolean},setup:(t,e)=>(D((()=>O.emit("scale-extent",t.scaleExtent))),D((()=>O.emit("branch",t.branch))),D((()=>O.emit("sharp-corner",t.sharpCorner))),D((()=>O.emit("gap",{xGap:t.xGap,yGap:t.yGap}))),D((()=>O.emit("mindmap-context",e))),D((()=>Tt.value=t.edit&&t.addNodeBtn)),D((()=>Ft.drag=t.drag)),D((()=>Ft.edit=t.edit)),N((()=>{if(!(I.value&&R.value&&T.value&&q.value&&F.value))return;O.emit("selection-svg",a(I.value)),O.emit("selection-g",a(R.value)),O.emit("selection-asstSvg",a(T.value)),O.emit("selection-foreign",a(q.value)),O.emit("mmdata",new sn(h.cloneDeep(t.modelValue[0]),Vt,At,ae)),Et.value=!1,rn();const{svg:e,foreign:n}=K;null==n||n.raise(),F.value&&(Gt.observe(F.value),F.value.addEventListener("blur",Q),F.value.addEventListener("mousedown",(t=>t.stopPropagation()))),ie(),null==e||e.on("mousedown",(()=>{const t=document.getElementsByClassName(W.selected)[0];null==t||t.classList.remove(W.selected)})),st(t.zoom),it(t.ctm)})),z((()=>[t.branch,Tt.value,t.sharpCorner]),(()=>{Pe(),Et.value=!1})),z((()=>[t.xGap,t.yGap]),(t=>{on.setBoundingBox(t[0],t[1]),Pe()})),z((()=>[t.drag,t.edit]),(t=>{(t=>{const{g:e}=K;if(!e)return;const n=e.selectAll(`g.${W.text}`);t?n.on("mousedown",X):n.on("mousedown",null)})(t[0]||t[1]),(t=>{const{g:e}=K;if(!e)return;const n=e.selectAll(`g.node:not(.${W.root}) > g > g.${W.text}`);t?Rt(n):n.on(".drag",null)})(t[0]),(t=>{const{g:e}=K;if(!F.value||!e)return;const n=e.selectAll(`g.${W.text}`);t?n.on("click",Z):n.on("click",null)})(t[1])})),z((()=>t.zoom),(t=>st(t))),z((()=>t.ctm),(t=>it(t))),{wrapperEle:Y,svgEle:I,gEle:R,style:W,asstSvgEle:T,foreignEle:q,foreignDivEle:F,centerView:se,fitView:ie,download:ce,menu:kt,contextmenuPos:ut,onClickMenu:et,next:de,prev:he,hasPrev:Jt,hasNext:Xt})});const _n={ref:"gEle"},$n={ref:"foreignEle",style:{display:"none"}},kn={ref:"foreignDivEle",contenteditable:""};wn.render=function(t,e,n,a,l,s){const i=A("contextmenu");return C(),M("div",{class:t.style.container},[B("div",{id:t.style["svg-wrapper"],ref:"wrapperEle"},[(C(),M("svg",{class:t.style.svg,ref:"svgEle"},[B("g",_n,[(C(),M("foreignObject",$n,[B("div",kn,null,512)],512))],512)],2))],8,["id"]),(C(),M("svg",{ref:"asstSvgEle",class:t.style["asst-svg"]},null,2)),B("div",{class:[t.style["button-list"],t.style["right-bottom"]]},[t.centerBtn?(C(),M("button",{key:0,onClick:e[1]||(e[1]=e=>t.centerView())},[B("i",{class:t.style.gps},null,2)])):V("",!0),t.fitBtn?(C(),M("button",{key:1,onClick:e[2]||(e[2]=e=>t.fitView())},[B("i",{class:t.style.fit},null,2)])):V("",!0),t.downloadBtn?(C(),M("button",{key:2,onClick:e[3]||(e[3]=e=>t.download())},[B("i",{class:t.style.download},null,2)])):V("",!0)],2),t.timetravel?(C(),M("div",{key:0,class:[t.style["button-list"],t.style["right-top"]]},[B("button",{onClick:e[4]||(e[4]=(...e)=>t.prev&&t.prev(...e)),class:{[t.style.disabled]:!t.hasPrev}},[B("i",{class:t.style.prev},null,2)],2),B("button",{onClick:e[5]||(e[5]=(...e)=>t.next&&t.next(...e)),class:{[t.style.disabled]:!t.hasNext}},[B("i",{class:t.style.next},null,2)],2)],2)):V("",!0),t.ctm?(C(),M(i,{key:1,position:t.contextmenuPos,groups:t.menu,onClickItem:t.onClickMenu},null,8,["position","groups","onClickItem"])):V("",!0)],2)};var Mn=y({name:"App",components:{Mindmap:wn},setup(){const t=w({"center-btn":{value:!0},"fit-btn":{value:!0},timetravel:{value:!0},"download-btn":{value:!0},"add-node-btn":{value:!0},keyboard:{value:!1,disabled:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},"sharp-corner":{value:!1},vertical:{value:!1,disabled:!0}}),n=w({branch:{value:4,min:1,max:6},"x-gap":{value:84,min:0,max:100},"y-gap":{value:18,min:0,max:100}});return{data:e(H),checkboxList:t,rangeList:n}}});const Bn={class:"container"},Ln=B("div",{class:"left-top"},[B("a",{href:"https://github.com/hellowuxin/vue3-mindmap",target:"_blank"},"GitHub")],-1),Sn=B("div",{class:"right-top"},[B("span",null,"Props")],-1),Cn={class:"right-bottom"};Mn.render=function(t,e,n,a,l,s){const i=A("mindmap");return C(),M("div",Bn,[Ln,Sn,B(i,{class:"left-bottom",modelValue:t.data,"onUpdate:modelValue":e[1]||(e[1]=e=>t.data=e),branch:t.rangeList.branch.value,"x-gap":t.rangeList["x-gap"].value,"y-gap":t.rangeList["y-gap"].value,zoom:t.checkboxList.zoom.value,"fit-btn":t.checkboxList["fit-btn"].value,"center-btn":t.checkboxList["center-btn"].value,"download-btn":t.checkboxList["download-btn"].value,drag:t.checkboxList.drag.value,edit:t.checkboxList.edit.value,"add-node-btn":t.checkboxList["add-node-btn"].value,"sharp-corner":t.checkboxList["sharp-corner"].value,ctm:t.checkboxList.contextmenu.value,timetravel:t.checkboxList.timetravel.value},null,8,["modelValue","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","ctm","timetravel"]),B("div",Cn,[(C(!0),M(L,null,S(t.checkboxList,((t,e)=>(C(),M("div",{key:e},[$(B("input",{type:"checkbox",name:e.toString(),"onUpdate:modelValue":e=>t.value=e,disabled:t.disabled},null,8,["name","onUpdate:modelValue","disabled"]),[[P,t.value]]),B("label",{for:e.toString()},E(e),9,["for"])])))),128)),(C(!0),M(L,null,S(t.rangeList,((t,e)=>(C(),M("div",{key:e},[$(B("input",{type:"range",name:e,"onUpdate:modelValue":e=>t.value=e,min:t.min,max:t.max},null,8,["name","onUpdate:modelValue","min","max"]),[[G,t.value,void 0,{number:!0}]]),B("label",{for:e},E(e)+"（"+E(t.value)+"）",9,["for"])])))),128))])])},j(Mn).mount("#app");
