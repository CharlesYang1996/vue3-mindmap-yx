import{m as e,r as t,p as n,s as a,c as l,l as s,a as i,b as o,z as r,d,i as c,e as h,t as u,h as p,f as g,g as m,o as f,P as v,E as b,j as x,k as y,u as w,n as _,q as k,w as $,v as M,x as B,y as L,F as S,A as D,B as E,C as z,D as C,G as N,H as V,I as A,J as P,K as G,L as j,M as O,N as K}from"./vendor.2809cf71.js";var H=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",get svg(){return de},get g(){return ce},get asstSvg(){return he},get foreign(){return ue}}),I=[{name:"如何学习D3",children:[{name:"预备知识",children:[{name:"HTML & CSS"},{name:"JavaScript"},{name:"DOM"},{name:"SVG"},{name:"test\ntest"}]},{name:"安装",collapse:!0,children:[{name:"折叠节点"}]},{name:"入门",children:[{name:"选择集"},{name:"test"},{name:"绑定数据"},{name:"添加删除元素"},{name:"简单图形",children:[{name:"柱形图"},{name:"折线图"},{name:"散点图"}]},{name:"比例尺"},{name:"生成器"},{name:"过渡"}],left:!0},{name:"进阶",left:!0},{name:"一级节点",children:[{name:"子节点1"},{name:"子节点2"},{name:"子节点3"}]}]}];const T=e();var W={container:"Mindmap_container_fgvb6","svg-wrapper":"Mindmap_svg-wrapper_fgvb6","asst-svg":"Mindmap_asst-svg_fgvb6",svg:"Mindmap_svg_fgvb6",trigger:"Mindmap_trigger_fgvb6",dragging:"Mindmap_dragging_fgvb6","add-btn":"Mindmap_add-btn_fgvb6",hidden:"Mindmap_hidden_fgvb6","expand-btn":"Mindmap_expand-btn_fgvb6",text:"Mindmap_text_fgvb6",selected:"Mindmap_selected_fgvb6",content:"Mindmap_content_fgvb6",root:"Mindmap_root_fgvb6",edited:"Mindmap_edited_fgvb6",outline:"Mindmap_outline_fgvb6",collapse:"Mindmap_collapse_fgvb6","button-list":"Mindmap_button-list_fgvb6","right-bottom":"Mindmap_right-bottom_fgvb6","right-top":"Mindmap_right-top_fgvb6",disabled:"Mindmap_disabled_fgvb6",gps:"Mindmap_gps_fgvb6",fit:"Mindmap_fit_fgvb6",download:"Mindmap_download_fgvb6",prev:"Mindmap_prev_fgvb6",next:"Mindmap_next_fgvb6",close:"Mindmap_close_fgvb6"};const Y=t(),R=t(),U=t(),q=t(),F=t(),J=t();function X(){const e=this.querySelector(`g.${W["add-btn"]}`);e&&(e.style.opacity="1")}function Z(){const e=this.querySelector(`g.${W["add-btn"]}`);e&&(e.style.opacity="0")}const Q=(e,t)=>{e.stopPropagation(),st(t)};function ee(e,t){var n,a;const l=null==(n=this.parentNode)?void 0:n.parentNode,{foreign:s}=H;if(Ge&&s&&J.value){l.classList.add(W.edited),T.emit("edit-flag",!1),s.attr("x",t.x-2-(t.left?t.width:0)).attr("y",t.y-hn.data.y-2).attr("data-id",t.id).attr("data-name",t.name).style("display","");const e=J.value;e.textContent=t.name,e.focus(),null==(a=getSelection())||a.selectAllChildren(e);const n=l.querySelector(`:scope > .${W.content}`);n&&ht(n)}}const te=()=>{var e;if(null==(e=document.getElementsByClassName(W.edited)[0])||e.classList.remove(W.edited,W.selected),F.value&&J.value){F.value.style.display="none";const e=F.value.getAttribute("data-id"),t=F.value.getAttribute("data-name"),n=J.value.textContent;e&&null!==n&&n!==t&&pn(e,n)}},ne=e=>{if(e.preventDefault(),!Y.value)return;const t=lt(Y.value,e);ge.value=t;const n=e.composedPath().find((e=>{var t;return null==(t=e.classList)?void 0:t.contains("node")}));if(n){const{classList:e}=n,t=e.contains(W.root),a=e.contains(W.collapse);e.contains(W.selected)||st(n),ve.value.disabled=t,_e.value.disabled=t,Me.value.disabled=t,ye.value.disabled=t,we.value.disabled=t,xe.value.disabled=t,fe.value.disabled=!a,me.value.disabled=a||e.contains("leaf"),pe.value=!1}else pe.value=!0;T.emit("showContextmenu",!0)},ae=e=>{var t,n;switch(e){case"zoomfit":ct();break;case"zoomin":case"zoomout":ut(!0);break;case"add":le(new MouseEvent("click"),it());break;case"delete":vn(it().id);break;case"delete-one":bn(it().id);break;case"collapse":yn(it().id);break;case"expand":xn(it().id);break;case"add-sibling":{const e=it(),t=wn(e.id,"");t&&se(t)}break;case"add-sibling-before":{const e=it(),t=wn(e.id,"",!0);t&&se(t)}break;case"add-parent":{const e=it(),t=_n(e.id,"");t&&se(t)}break;case"cut":{const{id:e}=it(),n=null==(t=hn.find(e))?void 0:t.rawData;n&&navigator.clipboard.writeText(JSON.stringify(n)),vn(e)}break;case"copy":{const e=it(),t=null==(n=hn.find(e.id))?void 0:n.rawData;t&&navigator.clipboard.writeText(JSON.stringify(t))}break;case"paste":{const e=it();navigator.clipboard.readText().then((t=>{const n=ft(t)||{name:t};fn(e.id,n)}))}}},le=(e,t)=>{const n=fn(t.id,"");n&&se(n,e)};function se(e,t=new MouseEvent("click")){const{g:n}=H;if(!n)return;const a=n.selectAll(`g[data-id='${xt(e)}'] > g.${W.content} > g.${W.text}`).node();a&&(T.emit("edit-flag",!0),ee.call(a,t,e))}const ie=(e,t)=>{xn(t.id)};const oe=e=>{const{svg:t}=H;t&&(e?(qe(t),t.on("dblclick.zoom",null)):t.on(".zoom",null))},re=e=>{Y.value&&(e?Y.value.addEventListener("contextmenu",ne):Y.value.removeEventListener("contextmenu",ne))};let de,ce,he,ue;T.on("selection-svg",(e=>de=e)),T.on("selection-g",(e=>ce=e)),T.on("selection-asstSvg",(e=>he=e)),T.on("selection-foreign",(e=>ue=e));const pe=t(!0),ge=t({left:0,top:0}),me=t({name:"collapse",disabled:!0}),fe=t({name:"expand",disabled:!0}),ve=t({name:"delete",disabled:!1}),be=t({name:"add",disabled:!1}),xe=t({name:"add-parent",disabled:!1}),ye=t({name:"add-sibling",disabled:!1}),we=t({name:"add-sibling-before",disabled:!0}),_e=t({name:"cut",disabled:!1}),ke=t({name:"copy",disabled:!1}),$e=t({name:"paste",disabled:!1}),Me=t({name:"delete-one",disabled:!1}),Be=l((()=>[[be.value,xe.value,ye.value,we.value],[_e.value,ke.value,$e.value,ve.value,Me.value],[{name:"selectall",disabled:!0}],[me.value,fe.value]].filter(((e,t)=>0!==t&&1!==t||Ze.value.edit)))),Le=l((()=>[[{name:"zoomin",disabled:Ue.value.k>=Pe[1]},{name:"zoomout",disabled:Ue.value.k<=Pe[0]},{name:"zoomfit",disabled:!1}],[{name:"selectall",disabled:!0}]])),Se=l((()=>pe.value?Le.value:Be.value)),De=s().source((e=>e.source)).target((e=>e.target)),Ee=i().curve(o),ze=({source:e,target:t})=>Ee([e,t]);let Ce=!1,Ne=De;const Ve=t(!1);T.on("sharp-corner",(e=>{Ce!==e&&(Ve.value=!0),Ce=!!e,Ne=e?ze:De}));let Ae=4;T.on("branch",(e=>Ae=e||Ae));let Pe=[.1,8];T.on("scale-extent",(e=>Pe=e||Pe));let Ge=!1;T.on("edit-flag",(e=>Ge=!!e));let je=18,Oe=84,Ke=Math.min(je/2-1,10);T.on("gap",(e=>{e&&(Oe=e.xGap,je=e.yGap,Ke=Math.min(je/2-1,10),Ke=Math.min(Oe/2-1,Ke))}));const He=new ResizeObserver((e=>{const{foreign:t}=H;if(!t)return;const n=e[0],a=n.target,{width:l,height:s}=n.contentRect,i=2*(parseInt(getComputedStyle(a).paddingLeft||"0",10)+parseInt(getComputedStyle(a.parentNode).borderTopWidth||"0",10));t.attr("width",l+i).attr("height",s+i),"none"!==t.style("display")&&ht(a)})),Ie={side:12,padding:2,margin:8},Te=Ie.side+2*Ie.padding,We=16,Ye=4,Re=2,Ue=t(c),qe=r().on("zoom",(e=>{const{g:t}=H;t&&(Ue.value=e.transform,t.attr("transform",e.transform.toString()))})).scaleExtent(Pe),Fe=d().container((function(){var e,t;return null==(t=null==(e=this.parentNode)?void 0:e.parentNode)?void 0:t.parentNode})).on("drag",(function(e,t){var a;const l=null==(a=this.parentNode)?void 0:a.parentNode;R.value&&R.value.classList.add(W.dragging);const{g:s}=H;if(!s)return;rt(l,t,[e.x-t.x,e.y-t.y]);const i=n(e,U.value);i[1]+=hn.data.y;const o=s.selectAll("g.node").filter((e=>{if(e!==t&&e!==t.parent&&!e.id.startsWith(t.id)){let t=Ke,n=e.width+Ke;e.left&&0!==e.depth&&([t,n]=[n,t]);const a={x0:e.x-t,x1:e.x+n,y0:e.y-Ke,y1:e.y+e.height+Ke};return i[0]>a.x0&&i[1]>a.y0&&i[0]<a.x1&&i[1]<a.y1}return!1})),r=Array.from(document.getElementsByClassName(W.outline)),d=o.node();r.forEach((e=>{e!==d&&e.classList.remove(W.outline)})),null==d||d.classList.add(W.outline)})).on("end",(function(e,t){var n;const l=null==(n=this.parentNode)?void 0:n.parentNode;R.value&&R.value.classList.remove(W.dragging);const s=document.getElementsByClassName(W.outline)[0];if(s){s.classList.remove(W.outline);const e=s.getAttribute("data-id");if(!e)throw new Error("outline data-id null");return t.px=0,t.py=0,void gn(e,t.id)}const i=t.x-hn.getRootWidth()/2,o=1===t.depth&&i*(i+t.px)<0,r=o?e=>e.left!==t.left:e=>e.left===t.left,d=l.parentNode;let c=o?{y:1/0,id:t.id}:t,h=o?{y:-1/0,id:t.id}:t;const u=a(d).selectAll(`g.${vt(t).join(".")}`).filter((e=>e!==t&&r(e))),p=t.y+t.py;u.each((e=>{(o||e.y>t.y)&&e.y<p&&e.y>h.y&&(h=e),(o||e.y<t.y)&&e.y>p&&e.y<c.y&&(c=e)})),c.id!==t.id?(t.px=0,t.py=0,mn(t.id,c.id)):h.id!==t.id?(t.px=0,t.py=0,mn(t.id,h.id,1)):o?(t.px=0,t.py=0,kn(t.id)):rt(l,t,[0,0],500)})),Je=t(!1);let Xe;T.on("mindmap-context",(e=>e?Xe=e:null));const Ze=t({drag:!1,edit:!1});const Qe=new class{constructor(e=20){this.length=e,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(e){const t=h.cloneDeep(e);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(t),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,h.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,h.cloneDeep(this.snapshots[this.cursor])):null}},et=t(!1),tt=t(!1),nt=e=>{const t=e.split("\n");return t.length>1&&""===t[t.length-1]&&t.pop(),t},at=(e,t)=>u().duration(e).ease(t),lt=(e,t)=>{const{pageX:n,pageY:a}=t,l=e.getBoundingClientRect();return{left:n-(l.left+window.pageXOffset),top:a-(l.top+window.pageYOffset)}};function st(e){const t=e instanceof SVGGElement?e:document.querySelector(`g[data-id='${xt(e)}']`),n=document.getElementsByClassName(W.selected)[0];if(!t)throw new Error("selectGNode failed");n?n!==t?(n.classList.remove(W.selected),t.classList.add(W.selected)):T.emit("edit-flag",!0):t.classList.add(W.selected)}function it(){return a(`.${W.selected}`).data()[0]}const ot=e=>{const{asstSvg:t}=H;if(!t)throw new Error("asstSvg undefined");const n=nt(e),a=t.append("text");a.selectAll("tspan").data(n).enter().append("tspan").text((e=>e)).attr("x",0);const l=a.node().getBBox();return a.remove(),{width:Math.max(l.width,22),height:Math.max(l.height,22)*n.length}},rt=(e,t,n,l=0)=>{const s=at(l,g);t.px=n[0],t.py=n[1],a(e).transition(s).attr("transform",bt),a(`g[data-id='${xt(t)}'] > path`).transition(s).attr("d",(e=>wt(e)))},dt=()=>{const{svg:e}=H;if(!e)return;const t=hn.data;qe.translateTo(e,0+t.width/2,0+t.height/2)},ct=()=>{const{svg:e}=H;if(!e||!U.value||!R.value)return;const t=U.value.getBBox(),n=R.value.getBoundingClientRect(),a=Math.min(n.width/t.width,n.height/t.height),l=n.width/2,s=n.height/2,i=t.width*a/2,o=t.height*a/2,r=c.translate(-t.x*a+l-i,-t.y*a+s-o).scale(a);qe.transform(e,r)},ht=e=>{const{svg:t}=H;if(t&&R.value){const{k:n}=Ue.value,a=e.getBoundingClientRect(),{x:l,y:s,width:i,height:o}=R.value.getBoundingClientRect(),r=a.x-l,d=r+a.width,c=a.y-s,h=c+a.height,u=2;let p=0,g=0;r<0&&(p=-r/n+u),(a.width>i||d>i)&&(p=-(d-i)/n-u),c<0&&(g=-c/n+u),(a.height>o||h>o)&&(g=-(h-o)/n-u),qe.translateBy(t,p,g)}},ut=e=>{const{svg:t}=H;t&&qe.scaleBy(t,e?1.1:.9)},pt=()=>{var e,t;Y.value&&(e=Y.value,t=hn.data.name,p(e).then((e=>{const n=e.toDataURL(),a=open();a&&(a.document.write(`<img src='${n}'>`),a.document.title=t,a.document.close())})))},gt=()=>{const e=Qe.next();e&&(hn.data=e,un(!1))},mt=()=>{const e=Qe.prev();e&&(hn.data=e,un(!1))},ft=e=>{let t;try{return t=JSON.parse(e),"name"in t&&t}catch(n){return!1}},vt=e=>{const t=["node"];return e&&t.push(`depth-${e.depth}`),t},bt=e=>`translate(${e.dx+e.px},${e.dy+e.py})`,xt=e=>e.id,yt=e=>{const t=nt(e.name),n=e.height/t.length;return t.map((e=>({name:e,height:n})))},wt=e=>{let t=0,n=0;const a=Math.max(Ke-3,0);let l=e.width+a;let s=3;const{parent:i}=e;i&&(t=i.width,n=i.height,0===i.depth&&(Ce||(t/=2),n/=2,s=0)),e.left&&(i&&(0!==i.depth?t=-t:Ce&&(t=0)),l=-l);const o=[-e.dx+t-e.px,-e.dy+n+s-e.py],r=[0,e.height+3];return`${Ne({source:o,target:r})}L${l},${r[1]}`},_t=(e,t,n,a,l)=>{e?(Et(t,10),Lt(n,10,6),St(a,10),l&&Dt(l,10)):(Et(t,Ke),Lt(n,Ke),St(a,Ke),l&&Dt(l,Ke))},kt=(e,t)=>{const n=e.attr("class",(e=>(e=>{const t=vt(e);return e&&(0===e.depth&&t.push(W.root),e.collapse?t.push(W.collapse):e.children&&0!==e.children.length||t.push("leaf")),t})(e).join(" "))).attr("data-id",xt);(t?n.transition(t):n).attr("transform",bt)},$t=(e,t)=>{(t?e.transition(t):e).attr("transform",(e=>`translate(${e.left?-e.width:0},0)`))},Mt=e=>{e.attr("alignment-baseline","text-before-edge").text((e=>e.name||" ")).attr("x",0).attr("dy",((e,t)=>t?e.height:0))},Bt=(e,t)=>{e.attr("cx",t).attr("cy",0).attr("r",1)},Lt=(e,t,n=4)=>{e.attr("x",(e=>-t-(e.left?e.width:0))).attr("y",-t).attr("rx",n).attr("ry",n).attr("width",(e=>e.width+2*t)).attr("height",(e=>e.height+2*t))},St=(e,t)=>{e.attr("class",W["expand-btn"]).attr("transform",(e=>((e,t)=>{const n=0===e.depth?e.height/2:e.height+3;let a=e.width+t+We/2+4;return e.left&&(a=-a),`translate(${a},${n})`})(e,t))).style("color",(e=>e.color))},Dt=(e,t)=>{e.attr("class",(e=>(e=>{const t=[W["add-btn"]];return e.collapse&&t.push(W.hidden),t})(e).join(" "))).attr("transform",(e=>((e,t)=>{const n=0===e.depth?e.height/2:e.height+3;let a=e.width+t+Te/2+Ie.margin;return e.left&&(a=-a),`translate(${a},${n})`})(e,t)))},Et=(e,t)=>{const n=Te+Ie.margin,a=2*t;e.attr("class",W.trigger).attr("x",(e=>-t-(e.left?e.width+n:0))).attr("y",-t).attr("width",(e=>e.width+a+n)).attr("height",(e=>e.height+a))},zt=(e,t)=>{const n=e.attr("stroke",(e=>e.color)).attr("stroke-width",Ae);if(t){const e=n.transition(t);Ve.value?e.attrTween("d",Ct):e.attr("d",wt)}else n.attr("d",wt)};function Ct(e,t,n){const a=wt(e),l=n[t],s=l.cloneNode(),i=l.getTotalLength();s.setAttribute("d",a);const o=s.getTotalLength(),r=[0],d=10/Math.max(i,o);let c=0;for(;(c+=d)<1;)r.push(c);r.push(1);const h=r.map((e=>{const t=l.getPointAtLength(e*i),n=s.getPointAtLength(e*o);return m([t.x,t.y],[n.x,n.y])}));return e=>e<1?"M"+h.map((t=>t(e))).join("L"):a}const Nt=e=>{const t=e.append("tspan");return Mt(t),t},Vt=e=>(Mt(e),e),At=e=>{const t=e.append("g");return(e=>{const{side:t,padding:n}=Ie,a=-n-t/2,l=t+2*n;e.attr("x",a).attr("y",a).attr("rx",4).attr("ry",4).attr("width",l).attr("height",l)})(t.append("rect")),t.append("path").attr("d",((e,t)=>{const n=-t/2,a=-e/2,l=e/2,s=t/2;return`M${s},${l}H${l}V${s}H${a}V${l}H${n}V${a}H${a}V${n}H${l}V${a}H${s}V${l}Z`})(2,Ie.side)),t},Pt=e=>{const t=At(e);return t.on("click",le),t},Gt=e=>{const t=e.append("g");return t.append("rect").attr("x",-We/2).attr("y",-Ye/2).attr("width",We).attr("height",Ye).attr("rx",Re).attr("ry",Re).attr("stroke",(e=>e.color||"grey")).attr("fill",(e=>e.color||"grey")),Bt(t.append("circle"),-4),Bt(t.append("circle"),0),Bt(t.append("circle"),4),t},jt=e=>{var t;const n=!(null==(t=e.data()[0])?void 0:t.depth),a=e.append("g");kt(a),zt(a.append("path"));const l=a.append("g").attr("class",W.content),s=l.append("rect"),i=l.append("g").attr("class",W.text),o=i.append("rect"),r=i.append("text");$t(r);const d=r.selectAll("tspan").data(yt).enter().append("tspan");let c;Mt(d),Je.value&&(c=Pt(l));const h=Gt(l);return _t(n,s,o,h,c),((e,t)=>{if(e.select(`:scope > g.${W.content} > g.${W["expand-btn"]}`).on("click",ie),Ze.value.drag||Ze.value.edit){const n=e.select(`:scope > g.${W.content} > g.${W.text}`);n.on("mousedown",Q),Ze.value.drag&&!t&&Fe(n),Ze.value.edit&&n.on("click",ee)}Je.value&&e.select(`:scope > g.${W.content}`).on("mouseenter",X).on("mouseleave",Z)})(a,n),a.each(((e,t)=>{e.children&&Kt(e.children,a.filter(((e,n)=>t===n)))})),l.raise(),a},Ot=e=>{var t;const n=!(null==(t=e.data()[0])?void 0:t.depth),a=at(500,g);kt(e,a),zt(e.select(":scope > path"),a);const l=e.select(`:scope > g.${W.content}`),s=l.select(":scope > rect"),i=l.select(`g.${W.text}`),o=i.select("rect"),r=i.select("text");$t(r,a),r.selectAll("tspan").data(yt).join(Nt,Vt,(e=>e.remove()));let d=l.select(`g.${W["add-btn"]}`);const c=l.select(`g.${W["expand-btn"]}`);return Je.value?d.node()||(d=Pt(l)):d.remove(),_t(n,s,o,c,d),e.each(((t,n)=>{t.children&&Kt(t.children,e.filter(((e,t)=>n===t)))})),l.raise(),e},Kt=(e=[hn.data],t=ce)=>{t.selectAll(`g.${vt(e[0]).join(".")}`).data(e,(e=>e.gKey)).join(jt,Ot)};class Ht{constructor(e,t,n,a){this.w=e,this.h=t,this.y=n,this.c=a,this.cs=a.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function It(e){0===e.cs?(e.el=e,e.er=e,e.msel=e.mser=0):(e.el=e.c[0].el,e.msel=e.c[0].msel,e.er=e.c[e.cs-1].er,e.mser=e.c[e.cs-1].mser)}function Tt(e){return e.y+e.h}class Wt{constructor(e,t,n){this.lowY=e,this.index=t,this.next=n}}function Yt(e,t,n){for(;null!==n&&e>=n.lowY;)n=n.next;return new Wt(e,t,n)}function Rt(e,t,n,a){e.c[t].mod+=a,e.c[t].msel+=a,e.c[t].mser+=a,function(e,t,n,a){if(n!==t-1){const l=t-n;e.c[n+1].shift+=a/l,e.c[t].shift-=a/l,e.c[t].change-=a-a/l}}(e,t,n,a)}function Ut(e){return 0===e.cs?e.tl:e.c[0]}function qt(e){return 0===e.cs?e.tr:e.c[e.cs-1]}function Ft(e,t,n){let a=e.c[t-1],l=a.mod,s=e.c[t],i=s.mod;for(;null!==a&&null!==s;){Tt(a)>n.lowY&&(n=n.next);const o=l+a.prelim+a.w-(i+s.prelim);o>0&&(i+=o,Rt(e,t,n.index,o));const r=Tt(a),d=Tt(s);r<=d&&(a=qt(a),null!==a&&(l+=a.mod)),r>=d&&(s=Ut(s),null!==s&&(i+=s.mod))}null===a&&null!==s?function(e,t,n,a){const l=e.c[0].el;l.tl=n;const s=a-n.mod-e.c[0].msel;l.mod+=s,l.prelim-=s,e.c[0].el=e.c[t].el,e.c[0].msel=e.c[t].msel}(e,t,s,i):null!==a&&null===s&&function(e,t,n,a){const l=e.c[t].er;l.tr=n;const s=a-n.mod-e.c[t].mser;l.mod+=s,l.prelim-=s,e.c[t].er=e.c[t-1].er,e.c[t].mser=e.c[t-1].mser}(e,t,a,l)}function Jt(e){if(0===e.cs)return void It(e);Jt(e.c[0]);let t=Yt(Tt(e.c[0].el),0,null);for(let n=1;n<e.cs;n++){Jt(e.c[n]);const a=Tt(e.c[n].er);Ft(e,n,t),t=Yt(a,n,t)}!function(e){e.prelim=(e.c[0].prelim+e.c[0].mod+e.c[e.cs-1].mod+e.c[e.cs-1].prelim+e.c[e.cs-1].w)/2-e.w/2}(e),It(e)}function Xt(e,t){t+=e.mod,e.x=e.prelim+t,function(e){let t=0,n=0;for(let a=0;a<e.cs;a++)t+=e.c[a].shift,n+=t+e.c[a].change,e.c[a].mod+=n}(e);for(let n=0;n<e.cs;n++)Xt(e.c[n],t)}function Zt(e){Jt(e),Xt(e,0)}class Qt{constructor(e,t){this.gap=e,this.bottomPadding=t}addBoundingBox(e,t){return{width:e+this.gap,height:t+this.bottomPadding}}removeBoundingBox(e,t){return{x:e+this.gap/2,y:t}}}class en{constructor(e){this.bb=e}layout(e){const t=this.convert(e);Zt(t);const{boundingBox:n,result:a}=this.assignLayout(t,e);return{result:a,boundingBox:n}}convert(e,t=0){const{width:n,height:a}=this.bb.addBoundingBox(e.width,e.height),l=[];if(e.children&&e.children.length)for(let s=0;s<e.children.length;s++)l[s]=this.convert(e.children[s],t+a);return new Ht(n,a,t,l)}assignCoordinates(e,t){const{x:n,y:a}=this.bb.removeBoundingBox(e.x,e.y);t.x=n,t.y=a;for(let l=0;l<e.c.length;l++)this.assignCoordinates(e.c[l],t.children[l])}getSize(e,t){const{x:n,y:a,width:l,height:s}=e;if(t||(t={left:n,right:n+l,top:a,bottom:a+s}),t.left=Math.min(t.left,n),t.right=Math.max(t.right,n+l),t.top=Math.min(t.top,a),t.bottom=Math.max(t.bottom,a+s),e.children)for(const i of e.children)this.getSize(i,t);return t}assignLayout(e,t,n){const{x:a,y:l}=this.bb.removeBoundingBox(e.x,e.y);t.x=a,t.y=l;const{width:s,height:i}=t;n||(n={left:a,right:a+s,top:l,bottom:l+i}),n.left=Math.min(n.left,a),n.right=Math.max(n.right,a+s),n.top=Math.min(n.top,l),n.bottom=Math.max(n.bottom,l+i);for(let o=0;o<e.c.length;o++)this.assignLayout(e.c[o],t.children[o],n);return{result:t,boundingBox:n}}}const tn=e=>[e.width,e.height]=[e.height,e.width],nn=e=>{e.parent?(e.dx=e.x-e.parent.x,e.dy=e.y-e.parent.y):(e.dx=0,e.dy=0)},an=(e,t)=>e.id=t,ln=e=>{e.parent?e.depth=e.parent.depth+1:e.depth=0},sn=e=>{e.parent&&e.parent.color&&(e.color=e.parent.color)},on=e=>{e.depth>1&&e.parent&&(e.left=e.parent.left)},rn=(e,t,n="0")=>{var a;t.forEach((t=>{t(e,n)}));const{children:l}=e;if(l)for(let s=0;s<l.length;){const i=l[s];"del"===i.id?(l.splice(s,1),null==(a=e.rawData.children)||a.splice(s,1)):(rn(i,t,`${n}-${s}`),s+=1)}},dn=(e,t)=>{const n=new Qt(t,e);return new en(n)};class cn{constructor(e,t,n,a,l=f(v)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.colorScale=l,this.getSize=a,this.layout=dn(t,n),this.data=this.createMdataFromData(e,"0"),this.renew()}createMdataFromData(e,t,n=null){const{name:a,collapse:l,children:s}=e,{width:i,height:o}=this.getSize(a),r=n?n.depth+1:0;let d=!1,c=n?n.color:"";1===r?(d=!!e.left,c=this.colorScale(`${this.colorNumber+=1}`)):0!==r&&n&&(d=n.left);const h={id:t,name:a,rawData:e,parent:n,left:d,color:c,depth:r,x:0,y:0,dx:0,dy:0,px:0,py:0,width:i,height:o,children:[],_children:[],collapse:!!l,gKey:this.gKey+=1};return s&&(h.collapse?s.forEach(((e,n)=>{h._children.push(this.createMdataFromData(e,`${t}-${n}`,h))})):s.forEach(((e,n)=>{h.children.push(this.createMdataFromData(e,`${t}-${n}`,h))}))),h}renew(...e){rn(this.data,[tn,ln,on]),this.data=this.l(this.data);const t=[tn,this.renewXY.bind(this),nn];rn(this.data,t.concat(e))}l(e){const{left:t,right:n}=(e=>{const t=Object.assign({},e),n=Object.assign({},e);if(e.collapse);else{const{children:a}=e;t.children=[],n.children=[],a.forEach((e=>{e.left?t.children.push(e):n.children.push(e),e.parent&&(e.parent=n)}))}return{left:t,right:n}})(e);return this.layout.layout(t),this.layout.layout(n),this.diffY=n.x-t.x,this.rootWidth=t.height,n.children=e.children,n}renewXY(e){[e.x,e.y]=[e.y,e.x],e.left&&(e.x=-e.x+this.rootWidth,e.y+=this.diffY)}getRootWidth(){return this.rootWidth}setBoundingBox(e,t){this.layout=dn(e,t),this.renew()}find(e){const t=e.split("-").map((e=>~~e));let n=this.data;for(let a=1;a<t.length;a++){const e=t[a],{children:l}=n;if(!(e<l.length))return null;n=l[e]}return n.id===e?n:null}rename(e,t){if(e.length>0){const n=this.find(e);if(n&&n.name!==t){n.name=t,n.rawData.name=t;const e=this.getSize(n.name);n.width=e.width,n.height=e.height,this.renew()}return n}return null}moveChild(e,t){var n,a;if(e===t)return null;const l=this.find(e),s=this.find(t),i=t.split("-").pop();if(i&&l&&s){const e=s.parent;null==(n=null==e?void 0:e.children)||n.splice(~~i,1),null==(a=null==e?void 0:e.rawData.children)||a.splice(~~i,1),s.parent=l,s.gKey=this.gKey+=1,s.depth=s.parent.depth+1,1===s.depth?s.color=this.colorScale(`${this.colorNumber+=1}`):s.left=s.parent.left,l.collapse?l._children.push(s):l.children.push(s),l.rawData.children?l.rawData.children.push(s.rawData):l.rawData.children=[s.rawData],this.renew(an,sn)}return s}moveSibling(e,t,n=0){const a=e.split("-"),l=t.split("-");let s=a.pop(),i=l.pop();if(e===t||a.length!==l.length||!s||!i)return null;const o=this.find(e),r=this.find(t);if(r&&o&&o.parent){s=parseInt(s,10),i=parseInt(i,10),s<i&&(i-=1);const{children:e}=o.parent,{children:t}=o.parent.rawData;if(e&&t)return e.splice(s,1),e.splice(i+n,0,o),t.splice(s,1),t.splice(i+n,0,o.rawData),1===o.depth&&(o.left=r.left),this.renew(an),o}return null}add(e,t){const n=this.find(e);if(n){if(n.collapse&&this.expand(e),n.rawData.children||(n.rawData.children=[]),"string"==typeof t){const e=t,a=this.getSize(e),l={name:e},s=n.color?n.color:this.colorScale(`${this.colorNumber+=1}`),i={id:`${n.id}-${n.children.length}`,name:e,rawData:l,parent:n,left:n.left,collapse:!1,color:s,gKey:this.gKey+=1,width:a.width,height:a.height,depth:n.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return n.children.push(i),n.rawData.children.push(l),this.renew(),i}{const e=t,a=this.createMdataFromData(e,`${n.id}-${n.children.length}`,n);return n.children.push(a),n.rawData.children.push(e),this.renew(),a}}return null}expand(e){return this.eoc(e,!1,[sn,an])}collapse(e){return this.eoc(e,!0)}eoc(e,t,n=[]){const a=this.find(e);return a&&(a.collapse=t,a.rawData.collapse=t,[a._children,a.children]=[a.children,a._children],this.renew(...n)),a}delete(e){const t=this.find(e);if(!t||!t.parent)throw new Error(t?"暂不支持删除根节点":"未找到需要删除的节点");t.id="del",this.renew(an)}deleteOne(e){var t;const n=this.find(e);if(n&&n.parent){const{parent:a,children:l,_children:s,collapse:i,rawData:o}=n,r=parseInt(e.split("-").pop(),10);a.children.splice(r,1,...i?s:l),null==(t=a.rawData.children)||t.splice(r,1,...o.children||[]),l.forEach((e=>{e.parent=a,1===e.depth&&(e.rawData.left=e.left)})),this.renew(an)}}addSibling(e,t,n=!1){var a;const l=this.find(e);if(l&&l.parent){const s=parseInt(e.split("-").pop(),10),{parent:i,left:o}=l,r={name:t,left:o},d=this.getSize(t),c=n?s:s+1,h={name:t,parent:i,children:[],_children:[],color:i.color?i.color:this.colorScale(`${this.colorNumber+=1}`),collapse:!1,rawData:r,id:`${i.id}-${c}`,left:o,gKey:this.gKey+=1,depth:l.depth,width:d.width,height:d.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return i.children.splice(c,0,h),null==(a=i.rawData.children)||a.splice(c,0,r),this.renew(an),h}return null}addParent(e,t){var n;const a=this.find(e);if(a&&a.parent){const{parent:e,left:l,color:s}=a,i=this.getSize(t),o=parseInt(a.id.split("-").pop(),10),r={name:t,children:[a.rawData],left:l};null==(n=e.rawData.children)||n.splice(o,1,r);const d={rawData:r,left:l,name:t,color:s,collapse:!1,parent:e,id:a.id,depth:a.depth,width:i.width,height:i.height,gKey:this.gKey+=1,children:[a],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return a.parent=d,e.children.splice(o,1,d),this.renew(an),d}return null}changeLeft(e){const t=this.find(e);return t&&(t.left=!t.left,this.renew()),t}}let hn;T.on("mmdata",(e=>e?hn=e:null));const un=(e=!0)=>{e&&Qe.snap(hn.data),Xe.emit("update:modelValue",b([hn.data.rawData])),et.value=Qe.hasPrev,tt.value=Qe.hasNext,Kt()},pn=(e,t)=>{hn.rename(e,t),un()},gn=(e,t)=>{hn.moveChild(e,t),un()},mn=(e,t,n=0)=>{hn.moveSibling(e,t,n),un()},fn=(e,t)=>{const n=hn.add(e,t);return un(),n},vn=e=>{hn.delete(e),un()},bn=e=>{hn.deleteOne(e),un()},xn=e=>{hn.expand(e),un()},yn=e=>{hn.collapse(e),un()},wn=(e,t,n=!1)=>{const a=hn.addSibling(e,t,n);return un(),a},_n=(e,t)=>{const n=hn.addParent(e,t);return un(),n},kn=e=>{hn.changeLeft(e),un()};x.init({fallbackLng:"zh",lng:"zh",resources:{zh:{translation:{contextmenu:{collapse:"折叠节点",expand:"展开节点",delete:"删除节点","delete-one":"删除单个节点",add:"新建子节点","add-parent":"新建父节点","add-sibling":"新建兄弟节点","add-sibling-before":"在此之前新建兄弟节点",cut:"剪切",copy:"拷贝",paste:"粘贴",selectall:"全选",zoomin:"放大",zoomout:"缩小",zoomfit:"缩放至合适大小"}}},en:{translation:{contextmenu:{collapse:"collapse",expand:"expand",delete:"delete","delete-one":"delete a single node",add:"add child node","add-parent":"add parent node","add-sibling":"add sibling node","add-sibling-before":"add sibling node before",cut:"cut",copy:"copy",paste:"paste",selectall:"select all",zoomin:"zoom in",zoomout:"zoom out",zoomfit:"zoom fit"}}}}});var $n=y({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(e,n){const a=t(!1),l=w(),s=t(),i=t(),o=_({top:0,left:0});T.on("showContextmenu",(async t=>{if(!s.value||!i.value)return;a.value=!!t,await k();const{offsetWidth:n,offsetHeight:l}=s.value,{offsetWidth:r,offsetHeight:d}=i.value,{top:c,left:h}=e.position;o.top=c+d>l?l-d-8:c,o.left=h+r>n?h-r:h}));const r=()=>a.value=!1;return{style:l,show:a,close:r,onClick:e=>{r(),n.emit("click-item",e)},menuEle:i,containerEle:s,pos:o,i18n:x}}});var Mn={container:"Contextmenu_container_154ic",menu:"Contextmenu_menu_154ic",disabled:"Contextmenu_disabled_154ic"};($n.__cssModules={}).$style=Mn,$n.render=function(e,t,n,a,l,s){return $((E(),B("div",{class:e.style.container,ref:"containerEle"},[L("div",{onMousedown:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},null,32),L("div",{ref:"menuEle",id:e.style.menu,style:{top:e.pos.top+"px",left:e.pos.left+"px"}},[(E(!0),B(S,null,D(e.groups,((t,n)=>(E(),B("ul",{key:n},[(E(!0),B(S,null,D(t,(t=>(E(),B("li",{class:t.disabled?e.style.disabled:"",key:t.name,onClick:n=>e.onClick(t.name)},z(e.i18n.t(`contextmenu.${t.name}`)),11,["onClick"])))),128))])))),128))],12,["id"])],2)),[[M,e.show]])};var Bn=y({name:"Mindmap",components:{Contextmenu:$n},props:{modelValue:{type:Array,required:!0},xGap:{type:Number,default:Oe},yGap:{type:Number,default:je},branch:{type:Number,default:Ae,validator:e=>e>=1&&e<=6},scaleExtent:{type:Object,default:Pe},sharpCorner:Boolean,centerBtn:Boolean,fitBtn:Boolean,downloadBtn:Boolean,timetravel:Boolean,addNodeBtn:Boolean,edit:Boolean,drag:Boolean,keyboard:Boolean,ctm:Boolean,zoom:Boolean,locale:{type:String,default:"zh"}},setup:(e,t)=>(C((()=>x.changeLanguage(e.locale))),C((()=>T.emit("scale-extent",e.scaleExtent))),C((()=>T.emit("branch",e.branch))),C((()=>T.emit("sharp-corner",e.sharpCorner))),C((()=>T.emit("gap",{xGap:e.xGap,yGap:e.yGap}))),C((()=>T.emit("mindmap-context",t))),C((()=>Je.value=e.edit&&e.addNodeBtn)),C((()=>Ze.value.drag=e.drag)),C((()=>Ze.value.edit=e.edit)),N((()=>{if(!(R.value&&U.value&&q.value&&F.value&&J.value))return;T.emit("selection-svg",a(R.value)),T.emit("selection-g",a(U.value)),T.emit("selection-asstSvg",a(q.value)),T.emit("selection-foreign",a(F.value)),T.emit("mmdata",new cn(h.cloneDeep(e.modelValue[0]),Oe,je,ot)),Ve.value=!1,un();const{svg:t,foreign:n}=H;null==n||n.raise(),J.value&&(He.observe(J.value),J.value.addEventListener("blur",te),J.value.addEventListener("mousedown",(e=>e.stopPropagation()))),ct(),null==t||t.on("mousedown",(()=>{const e=document.getElementsByClassName(W.selected)[0];null==e||e.classList.remove(W.selected)})),oe(e.zoom),re(e.ctm)})),V((()=>[e.branch,Je.value,e.sharpCorner]),(()=>{Kt(),Ve.value=!1})),V((()=>[e.xGap,e.yGap]),(e=>{hn.setBoundingBox(e[0],e[1]),Kt()})),V((()=>[e.drag,e.edit]),(e=>{(e=>{const{g:t}=H;if(!t)return;const n=t.selectAll(`g.${W.text}`);e?n.on("mousedown",Q):n.on("mousedown",null)})(e[0]||e[1]),(e=>{const{g:t}=H;if(!t)return;const n=t.selectAll(`g.node:not(.${W.root}) > g > g.${W.text}`);e?Fe(n):n.on(".drag",null)})(e[0]),(e=>{const{g:t}=H;if(!J.value||!t)return;const n=t.selectAll(`g.${W.text}`);e?n.on("click",ee):n.on("click",null)})(e[1])})),V((()=>e.zoom),(e=>oe(e))),V((()=>e.ctm),(e=>re(e))),{wrapperEle:Y,svgEle:R,gEle:U,style:W,asstSvgEle:q,foreignEle:F,foreignDivEle:J,centerView:dt,fitView:ct,download:pt,menu:Se,contextmenuPos:ge,onClickMenu:ae,next:gt,prev:mt,hasPrev:et,hasNext:tt})});const Ln={ref:"gEle"},Sn={ref:"foreignEle",style:{display:"none"}},Dn={ref:"foreignDivEle",contenteditable:""};Bn.render=function(e,t,n,a,l,s){const i=A("contextmenu");return E(),B("div",{class:e.style.container},[L("div",{id:e.style["svg-wrapper"],ref:"wrapperEle"},[(E(),B("svg",{class:e.style.svg,ref:"svgEle"},[L("g",Ln,[(E(),B("foreignObject",Sn,[L("div",Dn,null,512)],512))],512)],2))],8,["id"]),(E(),B("svg",{ref:"asstSvgEle",class:e.style["asst-svg"]},null,2)),L("div",{class:[e.style["button-list"],e.style["right-bottom"]]},[e.centerBtn?(E(),B("button",{key:0,onClick:t[1]||(t[1]=t=>e.centerView())},[L("i",{class:e.style.gps},null,2)])):P("",!0),e.fitBtn?(E(),B("button",{key:1,onClick:t[2]||(t[2]=t=>e.fitView())},[L("i",{class:e.style.fit},null,2)])):P("",!0),e.downloadBtn?(E(),B("button",{key:2,onClick:t[3]||(t[3]=t=>e.download())},[L("i",{class:e.style.download},null,2)])):P("",!0)],2),e.timetravel?(E(),B("div",{key:0,class:[e.style["button-list"],e.style["right-top"]]},[L("button",{onClick:t[4]||(t[4]=(...t)=>e.prev&&e.prev(...t)),class:{[e.style.disabled]:!e.hasPrev}},[L("i",{class:e.style.prev},null,2)],2),L("button",{onClick:t[5]||(t[5]=(...t)=>e.next&&e.next(...t)),class:{[e.style.disabled]:!e.hasNext}},[L("i",{class:e.style.next},null,2)],2)],2)):P("",!0),e.ctm?(E(),B(i,{key:1,position:e.contextmenuPos,groups:e.menu,onClickItem:e.onClickMenu},null,8,["position","groups","onClickItem"])):P("",!0)],2)};var En=y({name:"App",components:{Mindmap:Bn},setup(){const e=_({"center-btn":{value:!0},"fit-btn":{value:!0},timetravel:{value:!0},"download-btn":{value:!0},"add-node-btn":{value:!0},keyboard:{value:!1,disabled:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},"sharp-corner":{value:!1},vertical:{value:!1,disabled:!0}}),n=_({branch:{value:4,min:1,max:6},"x-gap":{value:84,min:0,max:100},"y-gap":{value:18,min:0,max:100}});return{data:t(I),checkboxList:e,rangeList:n,locale:t("zh")}}});const zn={class:"container"},Cn=L("div",{class:"left-top"},[L("a",{href:"https://github.com/hellowuxin/vue3-mindmap",target:"_blank"},"GitHub")],-1),Nn=L("div",{class:"right-top"},[L("span",null,"Props")],-1),Vn={class:"right-bottom"},An=L("label",{for:"language-select"},"Language",-1),Pn=L("option",{value:"zh"},"简体中文",-1),Gn=L("option",{value:"en"},"English",-1);En.render=function(e,t,n,a,l,s){const i=A("mindmap");return E(),B("div",zn,[Cn,Nn,L(i,{class:"left-bottom",modelValue:e.data,"onUpdate:modelValue":t[1]||(t[1]=t=>e.data=t),branch:e.rangeList.branch.value,"x-gap":e.rangeList["x-gap"].value,"y-gap":e.rangeList["y-gap"].value,zoom:e.checkboxList.zoom.value,"fit-btn":e.checkboxList["fit-btn"].value,"center-btn":e.checkboxList["center-btn"].value,"download-btn":e.checkboxList["download-btn"].value,drag:e.checkboxList.drag.value,edit:e.checkboxList.edit.value,"add-node-btn":e.checkboxList["add-node-btn"].value,"sharp-corner":e.checkboxList["sharp-corner"].value,ctm:e.checkboxList.contextmenu.value,timetravel:e.checkboxList.timetravel.value,locale:e.locale},null,8,["modelValue","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","ctm","timetravel","locale"]),L("div",Vn,[L("div",null,[An,$(L("select",{id:"language-select","onUpdate:modelValue":t[2]||(t[2]=t=>e.locale=t)},[Pn,Gn],512),[[G,e.locale]])]),(E(!0),B(S,null,D(e.checkboxList,((e,t)=>(E(),B("div",{key:t},[$(L("input",{type:"checkbox",name:t.toString(),"onUpdate:modelValue":t=>e.value=t,disabled:e.disabled},null,8,["name","onUpdate:modelValue","disabled"]),[[j,e.value]]),L("label",{for:t.toString()},z(t),9,["for"])])))),128)),(E(!0),B(S,null,D(e.rangeList,((e,t)=>(E(),B("div",{key:t},[$(L("input",{type:"range",name:t,"onUpdate:modelValue":t=>e.value=t,min:e.min,max:e.max},null,8,["name","onUpdate:modelValue","min","max"]),[[O,e.value,void 0,{number:!0}]]),L("label",{for:t},z(t)+"（"+z(e.value)+"）",9,["for"])])))),128))])])},K(En).mount("#app");
